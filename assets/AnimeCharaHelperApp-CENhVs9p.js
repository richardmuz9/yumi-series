import{d as Ne,j as a,a as e,F as sa,e as oa,b as la}from"./index-C42zyR5t.js";import{b as o,k as ca,r as It,p as Tt,n as da,f as ua,u as Lt,I as ha}from"./vendor-IypXtaUq.js";import{G as Z,b as Ae,c as Re,d as ht,e as pa,f as Me,g as kt,h as ct,i as Be,j as Et,k as At,l as dt,m as Rt,n as ma,o as pt,p as mt,q as Bt,r as Ce,s as ga,t as _e,u as gt,v as Oe,w as fa,x as va,y as ya,z as ba,A as Sa,B as Na,C as Ca,D as tt,E as wa,F as Ft,H as xa,J as Dt,K as ka,L as Da,M as Pa,N as Ma,O as za,P as Ia,Q as Ta,R as La}from"./ModeToggle-BaEY7_BJ.js";import{A as Ea}from"./ArrowBack-CLZz7F0C.js";const ft="auth_token",Aa=()=>localStorage.getItem(ft),Ra=t=>{localStorage.setItem(ft,t)},Ba=()=>{localStorage.removeItem(ft)},_t=()=>{const[t,n]=o.useState(Aa()),[r,i]=o.useState(!!t),[h,g]=o.useState(null),[m,p]=o.useState(!0),[f,w]=o.useState(null);return o.useEffect(()=>{i(!!t)},[t]),o.useEffect(()=>{Ne.get("/api/auth/me").then(N=>{g(N.data),w(null)}).catch(N=>{g(null),w(N.message)}).finally(()=>{p(!1)})},[]),{token:t,isAuthenticated:r,login:async(N,R)=>(p(!0),w(null),Ne.post("/auth/login",{email:N,password:R}).then(D=>{Ra(D.data.token),n(D.data.token),i(!0)}).catch(D=>{var S,E;const B=((E=(S=D.response)==null?void 0:S.data)==null?void 0:E.message)||"Login failed";throw w(B),new Error(B)}).finally(()=>{p(!1)})),logout:()=>{Ba(),n(null),i(!1)},user:h,loading:m,error:f}};function Fa(t){return Z({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8.58564 8.85449L3.63589 13.8042L8.83021 18.9985L9.99985 18.9978V18.9966H11.1714L14.9496 15.2184L8.58564 8.85449ZM9.99985 7.44027L16.3638 13.8042L19.1922 10.9758L12.8283 4.61185L9.99985 7.44027ZM13.9999 18.9966H20.9999V20.9966H11.9999L8.00229 20.9991L1.51457 14.5113C1.12405 14.1208 1.12405 13.4877 1.51457 13.0971L12.1212 2.49053C12.5117 2.1 13.1449 2.1 13.5354 2.49053L21.3136 10.2687C21.7041 10.6592 21.7041 11.2924 21.3136 11.6829L13.9999 18.9966Z"},child:[]}]})(t)}function _a(t){return Z({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M13.5 2C13.5 2.44425 13.3069 2.84339 13 3.11805V5H18C19.6569 5 21 6.34315 21 8V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V8C3 6.34315 4.34315 5 6 5H11V3.11805C10.6931 2.84339 10.5 2.44425 10.5 2C10.5 1.17157 11.1716 0.5 12 0.5C12.8284 0.5 13.5 1.17157 13.5 2ZM6 7C5.44772 7 5 7.44772 5 8V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V8C19 7.44772 18.5523 7 18 7H13H11H6ZM2 10H0V16H2V10ZM22 10H24V16H22V10ZM9 14.5C9.82843 14.5 10.5 13.8284 10.5 13C10.5 12.1716 9.82843 11.5 9 11.5C8.17157 11.5 7.5 12.1716 7.5 13C7.5 13.8284 8.17157 14.5 9 14.5ZM15 14.5C15.8284 14.5 16.5 13.8284 16.5 13C16.5 12.1716 15.8284 11.5 15 11.5C14.1716 11.5 13.5 12.1716 13.5 13C13.5 13.8284 14.1716 14.5 15 14.5Z"},child:[]}]})(t)}function Oa(t){return Z({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M15.825.12a.5.5 0 0 1 .132.584c-1.53 3.43-4.743 8.17-7.095 10.64a6.1 6.1 0 0 1-2.373 1.534c-.018.227-.06.538-.16.868-.201.659-.667 1.479-1.708 1.74a8.1 8.1 0 0 1-3.078.132 4 4 0 0 1-.562-.135 1.4 1.4 0 0 1-.466-.247.7.7 0 0 1-.204-.288.62.62 0 0 1 .004-.443c.095-.245.316-.38.461-.452.394-.197.625-.453.867-.826.095-.144.184-.297.287-.472l.117-.198c.151-.255.326-.54.546-.848.528-.739 1.201-.925 1.746-.896q.19.012.348.048c.062-.172.142-.38.238-.608.261-.619.658-1.419 1.187-2.069 2.176-2.67 6.18-6.206 9.117-8.104a.5.5 0 0 1 .596.04M4.705 11.912a1.2 1.2 0 0 0-.419-.1c-.246-.013-.573.05-.879.479-.197.275-.355.532-.5.777l-.105.177c-.106.181-.213.362-.32.528a3.4 3.4 0 0 1-.76.861c.69.112 1.736.111 2.657-.12.559-.139.843-.569.993-1.06a3 3 0 0 0 .126-.75zm1.44.026c.12-.04.277-.1.458-.183a5.1 5.1 0 0 0 1.535-1.1c1.9-1.996 4.412-5.57 6.052-8.631-2.59 1.927-5.566 4.66-7.302 6.792-.442.543-.795 1.243-1.042 1.826-.121.288-.214.54-.275.72v.001l.575.575zm-4.973 3.04.007-.005zm3.582-3.043.002.001h-.002z"},child:[]}]})(t)}function $a(t){return Z({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828zm2.121.707a1 1 0 0 0-1.414 0L4.16 7.547l5.293 5.293 4.633-4.633a1 1 0 0 0 0-1.414zM8.746 13.547 3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293z"},child:[]}]})(t)}function Ha(t){return Z({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M9.5 2.672a.5.5 0 1 0 1 0V.843a.5.5 0 0 0-1 0zm4.5.035A.5.5 0 0 0 13.293 2L12 3.293a.5.5 0 1 0 .707.707zM7.293 4A.5.5 0 1 0 8 3.293L6.707 2A.5.5 0 0 0 6 2.707zm-.621 2.5a.5.5 0 1 0 0-1H4.843a.5.5 0 1 0 0 1zm8.485 0a.5.5 0 1 0 0-1h-1.829a.5.5 0 0 0 0 1zM13.293 10A.5.5 0 1 0 14 9.293L12.707 8a.5.5 0 1 0-.707.707zM9.5 11.157a.5.5 0 0 0 1 0V9.328a.5.5 0 0 0-1 0zm1.854-5.097a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L8.646 5.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0l1.293-1.293Zm-3 3a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L.646 13.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0z"},child:[]}]})(t)}function Va(t){return Z({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M0 .5A.5.5 0 0 1 .5 0h5a.5.5 0 0 1 .5.5v5.277l4.147-4.131a.5.5 0 0 1 .707 0l3.535 3.536a.5.5 0 0 1 0 .708L10.261 10H15.5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5H3a3 3 0 0 1-2.121-.879A3 3 0 0 1 0 13.044m6-.21 7.328-7.3-2.829-2.828L6 7.188zM4.5 13a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0M15 15v-4H9.258l-4.015 4zM0 .5v12.495zm0 12.495V13z"},child:[]}]})(t)}function Ua(t){return Z({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10.646.646a.5.5 0 0 1 .708 0l4 4a.5.5 0 0 1 0 .708l-1.902 1.902-.829 3.313a1.5 1.5 0 0 1-1.024 1.073L1.254 14.746 4.358 4.4A1.5 1.5 0 0 1 5.43 3.377l3.313-.828zm-1.8 2.908-3.173.793a.5.5 0 0 0-.358.342l-2.57 8.565 8.567-2.57a.5.5 0 0 0 .34-.357l.794-3.174-3.6-3.6z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",d:"M2.832 13.228 8 9a1 1 0 1 0-1-1l-4.228 5.168-.026.086z"},child:[]}]})(t)}function Ya(t){return Z({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(t)}function Ot(t){return Z({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 0C460.22 3.56 96.44 38.2 71.01 287.61c-3.09 26.66-4.84 53.44-5.99 80.24l178.87-178.69c6.25-6.25 16.4-6.25 22.65 0s6.25 16.38 0 22.63L7.04 471.03c-9.38 9.37-9.38 24.57 0 33.94 9.38 9.37 24.59 9.37 33.98 0l57.13-57.07c42.09-.14 84.15-2.53 125.96-7.36 53.48-5.44 97.02-26.47 132.58-56.54H255.74l146.79-48.88c11.25-14.89 21.37-30.71 30.45-47.12h-81.14l106.54-53.21C500.29 132.86 510.19 26.26 512 0z"},child:[]}]})(t)}function Ga(t){return Z({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(t)}function Wa(t){return Z({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"},child:[]}]})(t)}function Xa(t){return Z({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m20.707 5.826-3.535-3.533a.999.999 0 0 0-1.408-.006L7.096 10.82a1.01 1.01 0 0 0-.273.488l-1.024 4.437L4 18h2.828l1.142-1.129 3.588-.828c.18-.042.345-.133.477-.262l8.667-8.535a1 1 0 0 0 .005-1.42zm-9.369 7.833-2.121-2.12 7.243-7.131 2.12 2.12-7.242 7.131zM4 20h16v2H4z"},child:[]}]})(t)}function ja(t){return Z({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 21a1 1 0 0 0 .24 0l4-1a1 1 0 0 0 .47-.26L21 7.41a2 2 0 0 0 0-2.82L19.42 3a2 2 0 0 0-2.83 0L4.3 15.29a1.06 1.06 0 0 0-.27.47l-1 4A1 1 0 0 0 3.76 21 1 1 0 0 0 4 21zM18 4.41 19.59 6 18 7.59 16.42 6zM5.91 16.51 15 7.41 16.59 9l-9.1 9.1-2.11.52z"},child:[]}]})(t)}function qa(t){return Z({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3"},child:[]},{tag:"path",attr:{d:"M18 13.3l-6.3 -6.3"},child:[]}]})(t)}const Pt=[{key:"back",icon:ht,label:"Back",action:"mode",value:"back",category:"navigation"},{key:"creative",icon:pa,label:"Draw",action:"mode",value:"creative",category:"drawing"},{key:"brush",icon:Me,label:"Brush",action:"tool",value:"brush",category:"drawing"},{key:"pencil",icon:ja,label:"Pencil",action:"tool",value:"pencil",category:"drawing"},{key:"marker",icon:Ya,label:"Marker",action:"tool",value:"marker",category:"drawing"},{key:"airbrush",icon:kt,label:"Airbrush",action:"tool",value:"airbrush",category:"drawing"},{key:"fine-liner",icon:Ot,label:"Fine Liner (Eyelashes)",action:"tool",value:"fine-liner",category:"drawing"},{key:"detail-brush",icon:Xa,label:"Detail Brush",action:"tool",value:"detail-brush",category:"drawing"},{key:"texture-brush",icon:Me,label:"Texture Brush",action:"tool",value:"texture-brush",category:"drawing"},{key:"eraser",icon:Fa,label:"Eraser",action:"tool",value:"eraser",category:"drawing"},{key:"precision-eraser",icon:qa,label:"Precision Eraser",action:"tool",value:"precision-eraser",category:"drawing"},{key:"character-library",icon:ct,label:"Character Library",action:"function",value:"character-library",category:"v12"},{key:"ai-color-assistant",icon:Va,label:"AI Color Assistant",action:"function",value:"ai-color-assistant",category:"v12"},{key:"smart-brush",icon:Be,label:"Smart Brush",action:"function",value:"smart-brush",category:"v12"},{key:"version-history",icon:Et,label:"Version History",action:"function",value:"version-history",category:"v12"},{key:"templates",icon:Ga,label:"Templates",action:"context",value:"templates",category:"creation"},{key:"poses",icon:Wa,label:"Poses",action:"context",value:"poses",category:"creation"},{key:"yumi-refs",icon:ct,label:"Yumi References",action:"function",value:"yumi-refs",category:"creation"},{key:"ai",icon:_a,label:"AI Generate",action:"mode",value:"ai-generate",category:"ai"},{key:"ai-outline",icon:Ua,label:"AI Outline",action:"tool",value:"ai-outline",category:"ai"},{key:"ai-brush",icon:kt,label:"AI Brush",action:"tool",value:"ai-brush",category:"ai"},{key:"ai-eraser",icon:Ha,label:"AI Eraser",action:"tool",value:"ai-eraser",category:"ai"},{key:"search",icon:At,label:"Search Photos",action:"context",value:"search",category:"panels"},{key:"upload",icon:dt,label:"Upload Files",action:"function",value:"upload",category:"utility"},{key:"customize",icon:Rt,label:"Customize",action:"function",value:"customize",category:"utility"},{key:"layers",icon:ma,label:"Layers",action:"context",value:"layers",category:"panels"},{key:"palette",icon:pt,label:"Colors",action:"context",value:"palette",category:"panels"},{key:"history",icon:mt,label:"History",action:"context",value:"history",category:"panels"},{key:"export",icon:Bt,label:"Export",action:"context",value:"export",category:"panels"}],Ja=({mode:t,context:n,setMode:r,setContext:i,onBack:h,onToolChange:g,selectedTool:m,onCustomizeToggle:p,onFileUpload:f,onYumiRefsToggle:w,onCharacterLibraryToggle:P,onAIColorAssistantToggle:I,onSmartBrushToggle:N,onVersionHistoryToggle:R})=>{const[D,B]=o.useState(!1),[S,E]=o.useState(!1),[u,b]=o.useState({x:0,y:0}),[x,d]=o.useState({x:0,y:0}),c=o.useRef(null),y=o.useRef(null),s=k=>{var X;if(k.target===c.current||k.target.closest(".drag-handle")){E(!0);const _=(X=c.current)==null?void 0:X.getBoundingClientRect();_&&d({x:k.clientX-_.left,y:k.clientY-_.top})}},C=k=>{S&&b({x:k.clientX-x.x,y:k.clientY-x.y})},T=()=>{E(!1)};o.useEffect(()=>{if(S)return document.addEventListener("mousemove",C),document.addEventListener("mouseup",T),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",T)}},[S,x]);const F=k=>{const X=Array.from(k.target.files||[]);X.length>0&&f&&f(X)},W=k=>{var X;if(k.key==="back"){h();return}k.action==="mode"?r(k.value):k.action==="context"?i(n===k.value?null:k.value):k.action==="tool"?g==null||g(k.value):k.action==="function"&&(k.key==="upload"?(X=y.current)==null||X.click():k.key==="customize"?p==null||p():k.key==="yumi-refs"?w==null||w():k.key==="character-library"?P==null||P():k.key==="ai-color-assistant"?I==null||I():k.key==="smart-brush"?N==null||N():k.key==="version-history"&&(R==null||R()))},V=()=>{B(!D)},ae=()=>t==="ai-generate"?Pt.filter(k=>k.category==="navigation"||k.category==="ai"||k.category==="creation"||k.category==="utility"||k.category==="v12"||k.key==="export"||k.key==="search"):Pt;return a("nav",{ref:c,className:`icon-bar ${D?"collapsed":""} ${S?"dragging":""}`,style:{transform:`translate(${u.x}px, ${u.y}px)`,cursor:S?"grabbing":"default"},onMouseDown:s,children:[e("input",{type:"file",ref:y,multiple:!0,accept:"image/*",onChange:F,style:{display:"none"}}),e("div",{className:"drag-handle",children:a("div",{className:"drag-dots",children:[e("span",{}),e("span",{}),e("span",{})]})}),e("button",{className:"collapse-toggle",onClick:V,title:D?"Expand Sidebar":"Collapse Sidebar",children:D?e(Ae,{size:16}):e(Re,{size:16})}),e("div",{className:"icons-container",children:ae().map(k=>{const X=k.icon,_=k.action==="mode"&&t===k.value||k.action==="context"&&n===k.value||k.action==="tool"&&m===k.value;return a("button",{className:`icon-button ${_?"active":""} ${k.category||""}`,onClick:()=>W(k),title:k.label,children:[e(X,{size:D?18:24}),!D&&e("span",{className:"icon-label",children:k.label}),k.category==="v12"&&!D&&e("span",{className:"version-badge",children:"v1.2"})]},k.key)})}),!D&&a("div",{className:"category-info",children:[e("div",{className:"category-separator"}),e("span",{className:"category-label",children:t==="ai-generate"?"AI Mode":"Creative Mode v1.2"})]})]})},$t=({onSelect:t,onClose:n})=>{const[r,i]=o.useState(""),[h,g]=o.useState([]),[m,p]=o.useState(!1),f=async()=>{if(r.trim()){p(!0);try{const w=await fetch(`/api/anime-chara/reference-search?q=${encodeURIComponent(r)}`);if(!w.ok)throw new Error("Search failed");const P=await w.json();g(P.results)}catch(w){console.error("Reference search failed:",w)}finally{p(!1)}}};return a("div",{className:"reference-search",children:[a("div",{className:"search-header",children:[a("div",{className:"search-input",children:[e("input",{type:"text",value:r,onChange:w=>i(w.target.value),placeholder:"Search for reference images...",onKeyPress:w=>w.key==="Enter"&&f()}),e("button",{onClick:f,disabled:m,children:e(At,{size:20})})]}),e("button",{className:"close-button",onClick:n,children:e(Ce,{size:20})})]}),e("div",{className:"search-results",children:m?e("div",{className:"loading",children:"Loading..."}):h.length>0?e("div",{className:"results-grid",children:h.map((w,P)=>e("div",{className:"result-item",onClick:()=>t(w),children:e("img",{src:w,alt:`Reference ${P+1}`})},P))}):e("div",{className:"no-results",children:r?"No results found":"Start searching for reference images"})})]})},Ht=o.forwardRef((t,n)=>{const{mode:r,tool:i,color:h,size:g,opacity:m,blendMode:p,zoom:f,position:w,activeLayer:P,onStateChange:I,layers:N,activeLayerId:R,onLayerChange:D,width:B=800,height:S=600}=t,E=o.useRef(null);o.useRef(null);const u=o.useRef(null),[b,x]=o.useState(!1),[d,c]=o.useState(!1),[y,s]=o.useState(!1),[C,T]=o.useState(!1),[F,W]=o.useState(null),[V,ae]=o.useState(i),[k,X]=o.useState(h),[_,le]=o.useState(g),[ge,ze]=o.useState(m),[Ie,St]=o.useState(p),[Ye,fe]=o.useState(!1),[ve,U]=o.useState(null),[ne,Q]=o.useState(!1),[we,ye]=o.useState(.5);o.useEffect(()=>{N.length===0&&xe("Background")},[]);const xe=(M=`Layer ${N.length+1}`)=>{const L=E.current;if(!L)return;const A=document.createElement("canvas");A.width=L.width,A.height=L.height;const j={id:`layer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:M,canvas:A,visible:!0,opacity:100,blendMode:"normal",locked:!1};return I({layers:[...N,j]}),D(j.id,A),j},ke=()=>N.find(M=>M.id===R)||null,he=()=>{const M=E.current,L=u.current;if(!(!M||!L)){if(L.clearRect(0,0,M.width,M.height),F){const A=M.getBoundingClientRect();L.drawImage(F,0,0,A.width,A.height)}N.forEach(A=>{A.visible&&A.canvas&&(L.save(),L.globalAlpha=A.opacity/100,L.globalCompositeOperation=A.blendMode,L.drawImage(A.canvas,0,0),L.restore())})}};o.useEffect(()=>{const M=E.current;if(!M)return;const L=M.getBoundingClientRect();M.width=L.width*window.devicePixelRatio,M.height=L.height*window.devicePixelRatio;const A=M.getContext("2d");A&&(A.scale(window.devicePixelRatio,window.devicePixelRatio),A.lineCap="round",A.lineJoin="round",u.current=A,he())},[k,_,F,N]);const Ge=M=>{if(!y||!u.current)return;const L=ke();if(!L||L.locked)return;c(!0);const A=M.currentTarget.getBoundingClientRect(),j=M.clientX-A.left,oe=M.clientY-A.top,H=L.canvas.getContext("2d");H&&(H.beginPath(),H.moveTo(j,oe),H.lineCap="round",H.lineJoin="round",H.lineWidth=_,V==="eraser"?H.globalCompositeOperation="destination-out":(H.globalCompositeOperation="source-over",H.strokeStyle=k),H.globalAlpha=ge/100)},We=M=>{if(!d||!y)return;const L=E.current;if(!L)return;const A=L.getBoundingClientRect(),j=M.clientX-A.left,oe=M.clientY-A.top;if(V.startsWith("ai-"))Je(j,oe);else{const H=ke();if(H&&!H.locked){const ce=H.canvas.getContext("2d");ce&&(ce.lineTo(j,oe),ce.stroke(),he())}}},be=()=>{if(!u.current)return;const M=ke();if(M){const L=M.canvas.getContext("2d");L==null||L.closePath()}c(!1)},Xe=M=>{M.preventDefault();const L=M.touches[0],A=new MouseEvent("mousedown",{clientX:L.clientX,clientY:L.clientY});Ge(A)},je=M=>{M.preventDefault();const L=M.touches[0],A=new MouseEvent("mousemove",{clientX:L.clientX,clientY:L.clientY});We(A)},qe=M=>{M.preventDefault(),be()},Je=async(M,L)=>{var oe;if(!d||!y||!u.current)return;const A=ke();if(!A||A.locked)return;const j={x:Math.max(0,M-50),y:Math.max(0,L-50),width:100,height:100};Q(!0);try{const H=(oe=E.current)==null?void 0:oe.toDataURL();if(!H)return;const ce=await fetch("/api/anime-chara/ai-draw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageData:H,mode:V.replace("ai-",""),strength:we,region:j})});if(!ce.ok)throw new Error("AI drawing failed");const Ke=await ce.json(),Te=xe("AI Drawing");if(Te){const De=new Image;De.onload=()=>{const pe=Te.canvas.getContext("2d");pe&&(pe.drawImage(De,0,0),he())},De.src=`data:image/png;base64,${Ke.imageData}`}}catch(H){console.error("AI drawing failed:",H)}finally{Q(!1)}};return o.useImperativeHandle(n,()=>({loadOutline:M=>{const L=new Image;L.onload=()=>{const A=E.current;if(!A)return;const j=A.getContext("2d");j&&j.drawImage(L,0,0)},L.src=M},saveDrawing:()=>{var M;return((M=E.current)==null?void 0:M.toDataURL())||""},clearCanvas:()=>{const M=E.current,L=u.current;!M||!L||(L.clearRect(0,0,M.width,M.height),he())},setDrawingMode:M=>{s(M)},exportLayers:()=>N,importLayers:M=>{I({layers:M}),he()},regenerateRegion:async M=>{Q(!0);try{}catch(L){console.error("Region regeneration failed:",L)}finally{Q(!1)}},getCanvas:()=>E.current,undo:()=>{},redo:()=>{}})),r==="ai-generate"?e("div",{className:"canvas-area",children:a("div",{className:"ai-generate-placeholder",children:[e("h2",{children:"AI Generation Mode"}),e("p",{children:"Select options from the right panel to generate your character"})]})}):a("div",{className:"canvas-area",children:[a("div",{className:"drawing-tools",children:[e("button",{className:`tool-button ${V==="brush"?"active":""}`,onClick:()=>ae("brush"),title:"Brush",children:e(Oa,{size:20})}),e("button",{className:`tool-button ${V==="eraser"?"active":""}`,onClick:()=>ae("eraser"),title:"Eraser",children:e($a,{size:20})}),e("div",{className:"tool-separator"}),a("div",{className:"color-picker",children:[e(pt,{size:20}),e("input",{type:"color",value:k,onChange:M=>X(M.target.value),title:"Color"})]}),a("div",{className:"size-slider",children:[e(ga,{size:20}),e("input",{type:"range",min:"1",max:"50",value:_,onChange:M=>le(parseInt(M.target.value)),title:"Size"})]}),e("button",{className:"tool-button",onClick:()=>{he(),I({hasDrawing:!1})},title:"Clear Canvas",children:e(_e,{size:20})})]}),e("canvas",{ref:E,onMouseDown:Ge,onMouseMove:We,onMouseUp:be,onMouseLeave:be,onTouchStart:Xe,onTouchMove:je,onTouchEnd:qe,className:"drawing-canvas",style:{cursor:ne?"wait":"crosshair"}}),ve&&a("div",{className:"reference-image-container",children:[e("img",{src:ve,alt:"Reference"}),e("button",{className:"close-reference",onClick:()=>U(null),title:"Close Reference",children:e(Ce,{size:20})})]}),Ye&&e($t,{onSelect:M=>{U(M),fe(!1)},onClose:()=>fe(!1)})]})});Ht.displayName="CanvasArea";const Ka=({layers:t,activeLayerId:n,onAddLayer:r,onUpdateLayer:i,onDeleteLayer:h,onSelectLayer:g})=>a("div",{className:"layers-panel",children:[a("div",{className:"layers-header",children:[e("h3",{children:"Layers"}),e("button",{className:"add-layer-btn",onClick:r,title:"Add new layer",children:e(gt,{size:20})})]}),e("div",{className:"layers-list",children:t.map(m=>a("div",{className:`layer-item ${m.id===n?"active":""}`,onClick:()=>g(m.id),children:[a("div",{className:"layer-controls",children:[e("button",{className:`visibility-btn ${m.visible?"visible":""}`,onClick:p=>{p.stopPropagation(),i(m.id,{visible:!m.visible})},title:m.visible?"Hide layer":"Show layer",children:m.visible?e(Oe,{size:16}):e(fa,{size:16})}),e("button",{className:`lock-btn ${m.locked?"locked":""}`,onClick:p=>{p.stopPropagation(),i(m.id,{locked:!m.locked})},title:m.locked?"Unlock layer":"Lock layer",children:m.locked?e(va,{size:16}):e(ya,{size:16})})]}),e("input",{type:"text",value:m.name,onChange:p=>i(m.id,{name:p.target.value}),onClick:p=>p.stopPropagation(),className:"layer-name-input"}),a("div",{className:"layer-settings",children:[e("input",{type:"range",min:"0",max:"100",value:m.opacity,onChange:p=>i(m.id,{opacity:parseInt(p.target.value)}),onClick:p=>p.stopPropagation(),className:"opacity-slider",title:`Opacity: ${m.opacity}%`}),a("select",{value:m.blendMode,onChange:p=>i(m.id,{blendMode:p.target.value}),onClick:p=>p.stopPropagation(),className:"blend-mode-select",children:[e("option",{value:"normal",children:"Normal"}),e("option",{value:"multiply",children:"Multiply"}),e("option",{value:"screen",children:"Screen"}),e("option",{value:"overlay",children:"Overlay"}),e("option",{value:"darken",children:"Darken"}),e("option",{value:"lighten",children:"Lighten"})]}),t.length>1&&e("button",{className:"delete-btn",onClick:p=>{p.stopPropagation(),h(m.id)},title:"Delete layer",children:e(_e,{size:16})})]})]},m.id))})]}),Za=({color:t,onColorChange:n})=>{const[r,i]=o.useState(["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#808080"]);return a("div",{className:"palette-panel",children:[a("div",{className:"palette-header",children:[e("h3",{children:"Color Palette"}),e("button",{className:"add-color-btn",onClick:()=>{r.includes(t)||i(g=>[...g,t])},title:"Add current color",children:e(gt,{size:20})})]}),a("div",{className:"color-picker",children:[e("input",{type:"color",value:t,onChange:g=>n(g.target.value),className:"color-input"}),e("div",{className:"color-preview",style:{backgroundColor:t},children:e("span",{children:t.toUpperCase()})})]}),a("div",{className:"saved-colors",children:[e("h4",{children:"Saved Colors"}),e("div",{className:"color-grid",children:r.map((g,m)=>e("button",{className:"color-swatch",style:{backgroundColor:g},onClick:()=>n(g),title:g},m))})]}),a("div",{className:"color-sliders",children:[a("div",{className:"slider-group",children:[e("label",{children:"Red"}),e("input",{type:"range",min:"0",max:"255",value:parseInt(t.slice(1,3),16),onChange:g=>{const m=g.target.value.padStart(2,"0"),p=t.slice(3,5),f=t.slice(5,7);n(`#${m}${p}${f}`)}})]}),a("div",{className:"slider-group",children:[e("label",{children:"Green"}),e("input",{type:"range",min:"0",max:"255",value:parseInt(t.slice(3,5),16),onChange:g=>{const m=t.slice(1,3),p=g.target.value.padStart(2,"0"),f=t.slice(5,7);n(`#${m}${p}${f}`)}})]}),a("div",{className:"slider-group",children:[e("label",{children:"Blue"}),e("input",{type:"range",min:"0",max:"255",value:parseInt(t.slice(5,7),16),onChange:g=>{const m=t.slice(1,3),p=t.slice(3,5),f=g.target.value.padStart(2,"0");n(`#${m}${p}${f}`)}})]})]})]})},Qa=()=>a("div",{className:"history-panel",children:[a("div",{className:"history-header",children:[e("h3",{children:"History"}),a("div",{className:"history-controls",children:[e("button",{className:"undo-btn",title:"Undo",children:e(ba,{size:20})}),e("button",{className:"redo-btn",title:"Redo",children:e(Sa,{size:20})})]})]}),a("div",{className:"history-list",children:[a("div",{className:"history-item",children:[e("span",{className:"history-action",children:"Added Layer"}),e("span",{className:"history-time",children:"Just now"})]}),a("div",{className:"history-item",children:[e("span",{className:"history-action",children:"Changed Color"}),e("span",{className:"history-time",children:"2m ago"})]}),a("div",{className:"history-item",children:[e("span",{className:"history-action",children:"Drew Line"}),e("span",{className:"history-time",children:"5m ago"})]})]})]}),en=()=>{const[t,n]=o.useState("png"),[r,i]=o.useState(90),[h,g]=o.useState(100);return a("div",{className:"export-panel",children:[e("div",{className:"export-header",children:e("h3",{children:"Export"})}),a("div",{className:"export-settings",children:[a("div",{className:"setting-group",children:[e("label",{children:"Format"}),a("select",{value:t,onChange:p=>n(p.target.value),className:"format-select",children:[e("option",{value:"png",children:"PNG"}),e("option",{value:"jpg",children:"JPEG"}),e("option",{value:"webp",children:"WebP"}),e("option",{value:"svg",children:"SVG"})]})]}),t==="jpg"&&a("div",{className:"setting-group",children:[a("label",{children:["Quality (",r,"%)"]}),e("input",{type:"range",min:"1",max:"100",value:r,onChange:p=>i(parseInt(p.target.value)),className:"quality-slider"})]}),a("div",{className:"setting-group",children:[a("label",{children:["Size (",h,"%)"]}),e("input",{type:"range",min:"1",max:"400",value:h,onChange:p=>g(parseInt(p.target.value)),className:"size-slider"})]})]}),a("div",{className:"export-actions",children:[a("button",{className:"export-btn primary",onClick:()=>{console.log("Exporting with settings:",{format:t,quality:r,size:h})},children:[e(Bt,{size:20}),"Export"]}),a("button",{className:"export-btn",children:[e(Na,{size:20}),"Share"]}),a("button",{className:"export-btn",children:[e(Ca,{size:20}),"Copy"]})]}),a("div",{className:"export-preview",children:[e("h4",{children:"Preview"}),e("div",{className:"preview-container",children:e("div",{className:"preview-placeholder",children:"Preview not available"})})]})]})},Le={Popular:["gorgeous-anime","manga-sketch","semi-realistic","kawaii-moe"],Classic:["chibi","bishojo","shonen","magical-girl","shoujo-sparkle"],Modern:["cyberpunk-neon","minimalist-clean","pixel-art","watercolor-soft"],Atmospheric:["gothic-lolita","dark-fantasy","horror-creepy","vintage-retro"],Lifestyle:["sports-dynamic","slice-of-life","mecha-girl"]},tn=({onComplete:t,designBrief:n})=>{const[r,i]=o.useState([]),[h,g]=o.useState(null),[m,p]=o.useState(!0),[f,w]=o.useState(null),[P,I]=o.useState("Popular"),[N,R]=o.useState(""),[D,B]=o.useState(!1);o.useEffect(()=>{S()},[]);const S=async()=>{try{const c=await fetch("/api/anime-chara/templates",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!c.ok)throw new Error("Failed to fetch templates");const y=await c.json();i(y.templates||[])}catch(c){w(c instanceof Error?c.message:"Failed to load templates")}finally{p(!1)}},E=c=>{g(c),D&&t({template:c})},u=()=>{h&&t({template:h})},b=()=>{let c=r;return P&&Le[P]&&(c=c.filter(y=>Le[P].includes(y.id))),N&&(c=c.filter(y=>y.name.toLowerCase().includes(N.toLowerCase())||y.style.toLowerCase().includes(N.toLowerCase())||y.characteristics.some(s=>s.toLowerCase().includes(N.toLowerCase())))),c},x=c=>({"gorgeous-anime":"✨","manga-sketch":"🖤","semi-realistic":"🎨","kawaii-moe":"💖","cyberpunk-neon":"🌆","gothic-lolita":"🖤","shoujo-sparkle":"🌸","pixel-art":"🎮","watercolor-soft":"🎨","minimalist-clean":"⚪","vintage-retro":"📻","dark-fantasy":"🌙","sports-dynamic":"⚡","slice-of-life":"☀️","horror-creepy":"👻",chibi:"🥰",bishojo:"🌺",shonen:"💪","mecha-girl":"🤖","magical-girl":"🪄"})[c]||"🎭";if(m)return e("div",{className:"template-library loading",children:a("div",{className:"loading-spinner",children:[e("div",{className:"spinner-icon",children:"🎭"}),e("p",{children:"Loading enhanced art styles..."})]})});if(f)return a("div",{className:"template-library error",children:[a("div",{className:"error-message",children:["⚠️ ",f]}),e("button",{onClick:S,className:"retry-btn",children:"Try Again"})]});const d=b();return a("div",{className:"template-library enhanced",children:[a("div",{className:"library-header",children:[e("h2",{children:"🎭 Enhanced Style Presets"}),a("p",{children:["Choose from ",r.length," professional anime styles with one-click switching"]}),e("div",{className:"preview-controls",children:a("label",{className:"preview-toggle",children:[e("input",{type:"checkbox",checked:D,onChange:c=>B(c.target.checked)}),e("span",{className:"toggle-slider"}),"Live Preview Mode"]})})]}),a("div",{className:"library-controls",children:[a("div",{className:"search-bar",children:[e("input",{type:"text",placeholder:"Search styles... (e.g., 'realistic', 'cute', 'dark')",value:N,onChange:c=>R(c.target.value),className:"search-input"}),e("span",{className:"search-icon",children:"🔍"})]}),a("div",{className:"category-tabs",children:[Object.keys(Le).map(c=>a("button",{className:`category-tab ${P===c?"active":""}`,onClick:()=>I(c),children:[c,a("span",{className:"category-count",children:["(",Le[c].filter(y=>r.some(s=>s.id===y)).length,")"]})]},c)),a("button",{className:`category-tab ${P==="All"?"active":""}`,onClick:()=>I("All"),children:["All (",r.length,")"]})]})]}),n&&a("div",{className:"character-preview",children:[a("h3",{children:["Your Character: ",n.character.name||"Unnamed"]}),a("div",{className:"character-info",children:[a("span",{children:[e("strong",{children:"Personality:"})," ",n.character.personality]}),a("span",{children:[e("strong",{children:"Mood:"})," ",n.mood]})]})]}),e("div",{className:"templates-grid enhanced",children:d.map(c=>a("div",{className:`template-card enhanced ${(h==null?void 0:h.id)===c.id?"selected":""}`,onClick:()=>E(c),children:[a("div",{className:"template-preview",children:[e("div",{className:"template-icon",children:x(c.id)}),e("div",{className:"template-overlay",children:e("span",{className:"preview-text",children:D?"Click to Apply":"Click to Select"})})]}),a("div",{className:"template-info",children:[a("div",{className:"template-header",children:[e("h3",{children:c.name}),e("div",{className:"style-badge",children:c.style})]}),e("p",{className:"template-description",children:c.description}),e("div",{className:"template-features",children:a("div",{className:"features-list",children:[c.characteristics.slice(0,3).map((y,s)=>e("span",{className:"feature-tag",children:y},s)),c.characteristics.length>3&&a("span",{className:"feature-more",children:["+",c.characteristics.length-3," more"]})]})}),e("div",{className:"template-proportions compact",children:a("div",{className:"proportion-indicator",children:[a("span",{children:["Head: ",Math.round(c.proportions.headRatio*100),"%"]}),a("span",{children:["Body: ",Math.round(c.proportions.bodyRatio*100),"%"]})]})})]}),D&&e("div",{className:"quick-apply",children:e("button",{className:"apply-btn",children:"✨ Apply Style"})})]},c.id))}),d.length===0&&a("div",{className:"no-results",children:[e("div",{className:"no-results-icon",children:"🎭"}),e("h3",{children:"No styles found"}),e("p",{children:"Try adjusting your search or selecting a different category"})]}),h&&!D&&a("div",{className:"template-selection enhanced",children:[a("div",{className:"selected-template-info",children:[a("div",{className:"selection-header",children:[e("span",{className:"selection-icon",children:x(h.id)}),a("div",{children:[a("h3",{children:["Selected: ",h.name]}),e("p",{children:h.description})]})]}),a("div",{className:"style-characteristics",children:[e("h4",{children:"Style Features:"}),e("div",{className:"characteristics-grid",children:h.characteristics.map((c,y)=>e("span",{className:"characteristic-pill",children:c},y))})]})]}),a("button",{onClick:u,className:"continue-btn enhanced",children:["Continue with ",h.name," ➡️"]})]})]})},ut=[{id:"confident_stand",name:"Confident Stand",description:"Standing with hands on hips, confident pose",preview:"🧍‍♀️",category:"standing"},{id:"energetic_jump",name:"Energetic Jump",description:"Mid-jump with arms raised, full of energy",preview:"🤸‍♀️",category:"action"},{id:"relaxed_sitting",name:"Relaxed Sitting",description:"Sitting casually with a relaxed posture",preview:"🪑",category:"sitting"},{id:"happy_smile",name:"Happy Smile",description:"Bright, genuine smile with sparkling eyes",preview:"😊",category:"expression"},{id:"surprised_gasp",name:"Surprised Gasp",description:"Wide eyes and open mouth, surprised expression",preview:"😲",category:"expression"},{id:"mischievous_smirk",name:"Mischievous Smirk",description:"Slight smirk with a playful glint in the eyes",preview:"😏",category:"expression"},{id:"determined_fist",name:"Determined Fist",description:"Clenched fist raised, showing determination",preview:"✊",category:"action"},{id:"peaceful_meditation",name:"Peaceful Meditation",description:"Cross-legged sitting in peaceful meditation",preview:"🧘‍♀️",category:"sitting"}],an=({selectedPose:t,onPoseSelect:n,onClose:r})=>{const[i,h]=o.useState("all"),g=[{id:"all",name:"All Poses",icon:"🎭"},{id:"standing",name:"Standing",icon:"🧍‍♀️"},{id:"action",name:"Action",icon:"🤸‍♀️"},{id:"sitting",name:"Sitting",icon:"🪑"},{id:"expression",name:"Expression",icon:"😊"}],m=i==="all"?ut:ut.filter(f=>f.category===i),p=f=>{switch(f){case"standing":return"🧍‍♀️";case"action":return"🤸‍♀️";case"sitting":return"🪑";case"expression":return"😊";default:return"🎭"}};return e("div",{className:"pose-library-modal",children:a("div",{className:"pose-library-content",children:[a("div",{className:"pose-library-header",children:[e("h3",{children:"🎭 Pose Library"}),e("button",{className:"close-btn",onClick:r,children:"×"})]}),e("div",{className:"category-tabs",children:g.map(f=>a("button",{className:`category-tab ${i===f.id?"active":""}`,onClick:()=>h(f.id),children:[e("span",{className:"category-icon",children:f.icon}),e("span",{className:"category-name",children:f.name})]},f.id))}),e("div",{className:"poses-grid",children:m.map(f=>a("div",{className:`pose-card ${t.id===f.id?"selected":""}`,onClick:()=>n(f),children:[e("div",{className:"pose-preview",children:e("span",{className:"pose-emoji",children:f.preview})}),a("div",{className:"pose-info",children:[e("h4",{className:"pose-name",children:f.name}),e("p",{className:"pose-description",children:f.description}),a("span",{className:"pose-category",children:[p(f.category)," ",f.category]})]})]},f.id))}),e("div",{className:"pose-actions",children:e("button",{onClick:()=>n(t),className:"confirm-pose-btn",children:"✅ Use Selected Pose"})})]})})},Fe=[{id:"yumi-1",src:"/references/yumi-1.png",title:"Yumi Madi Style",description:"Classic Yumi character design with signature style",tags:["classic","signature","character-design"]},{id:"yumi-2",src:"/references/yumi-2.png",title:"Yumi Sort Style",description:"Alternative Yumi design with unique styling",tags:["alternative","unique","styling"]},{id:"yumi-3",src:"/references/yumi-3.png",title:"Yumi with Bubble Tea",description:"Yumi enjoying bubble tea - casual scene reference",tags:["casual","bubble-tea","lifestyle","scene"]}],at=t=>Fe.filter(n=>n.tags.includes(t)),nn=[{id:"all",label:"All References",count:Fe.length},{id:"classic",label:"Classic Designs",count:at("classic").length},{id:"casual",label:"Casual Scenes",count:at("casual").length},{id:"alternative",label:"Alternative Styles",count:at("alternative").length}],rn=`
All Yumi reference images are AI-generated original content owned by our platform. 
These images are provided for drawing reference and inspiration purposes only.
By using these references, you agree to respect the original artistic style and intent.
`;Array.from({length:7},(t,n)=>({id:`yumi-${n+4}`,src:`/references/yumi-${n+4}.png`,title:`Yumi Reference ${n+4}`,description:"Future reference image - coming soon!",tags:["coming-soon"]}));const sn=({onClose:t,onSelect:n})=>{const[r,i]=o.useState(!1),[h,g]=o.useState(null),[m,p]=o.useState("all"),[f,w]=o.useState(null),[P,I]=o.useState(null),N=o.useRef(null),R=u=>{var d;const b=(d=u.target.files)==null?void 0:d[0];if(!b)return;if(!b.type.startsWith("image/")){alert("Please select an image file.");return}if(b.size>10*1024*1024){alert("File size must be less than 10MB.");return}I(b);const x=URL.createObjectURL(b);g(x)},D=async()=>{if(P)try{const u=new FormData;u.append("artwork",P);const b=await fetch("/api/art/upload",{method:"POST",body:u,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(b.ok){const x=await b.json();alert(`🎉 Thanks for sharing! Your artwork has been submitted for review.

🎁 Reward: You'll receive 1000 timeshards once approved!
💫 First contribution bonus: +500 extra timeshards!`)}else throw new Error("Upload failed");i(!1),g(null),I(null),N.current&&(N.current.value="")}catch(u){console.error("Upload failed:",u),alert("Upload failed. Please try again later.")}},B=u=>{n(u.src),t()},S=u=>{w(u)},E=m==="all"?Fe:Fe.filter(u=>u.tags.includes(m));return e("div",{className:"yumi-reference-modal-overlay",onClick:t,children:a("div",{className:"yumi-reference-modal",onClick:u=>u.stopPropagation(),children:[a("div",{className:"modal-header",children:[a("div",{className:"header-content",children:[e("h2",{children:"🎨 Yumi Reference Library"}),e("p",{className:"header-subtitle",children:"AI-generated Yumi images for drawing reference and inspiration"})]}),e("button",{onClick:t,className:"close-button",children:e(Ce,{size:24})})]}),e("div",{className:"category-filter",children:nn.map(u=>a("button",{className:`category-btn ${m===u.id?"active":""}`,onClick:()=>p(u.id),children:[u.label,a("span",{className:"count",children:["(",u.count,")"]})]},u.id))}),e("div",{className:"reference-grid",children:E.map(u=>a("div",{className:"reference-item",children:[a("div",{className:"reference-image-container",children:[e("img",{src:u.src,alt:u.title,className:"reference-image",onError:b=>{b.target.src="/placeholder-yumi.png"}}),a("div",{className:"reference-overlay",children:[e("button",{className:"overlay-btn preview-btn",onClick:()=>S(u),title:"Preview",children:e(Oe,{size:20})}),e("button",{className:"overlay-btn select-btn",onClick:()=>B(u),title:"Use as Reference",children:e(tt,{size:20})})]})]}),a("div",{className:"reference-info",children:[e("h4",{children:u.title}),e("p",{children:u.description}),e("div",{className:"reference-tags",children:u.tags.map(b=>e("span",{className:"tag",children:b},b))})]})]},u.id))}),a("div",{className:"share-art-section",children:[e("div",{className:"section-divider",children:e("span",{children:"Share Your Art"})}),r?a("div",{className:"upload-section",children:[e("h3",{children:"Upload Your Artwork"}),a("p",{className:"upload-description",children:["Share your original Yumi-inspired artwork with our community. By uploading, you agree to our terms and may allow us to feature your art.",e("br",{}),e("strong",{children:"🎁 Earn 1000+ timeshards for approved contributions!"})]}),h&&a("div",{className:"file-preview",children:[e("img",{src:h,alt:"Upload preview",className:"preview-image"}),a("div",{className:"preview-info",children:[e("p",{children:e("strong",{children:P==null?void 0:P.name})}),a("p",{children:["Size: ",P?(P.size/1024).toFixed(1):0," KB"]})]})]}),e("input",{type:"file",ref:N,accept:"image/*",onChange:R,className:"file-input"}),a("div",{className:"upload-actions",children:[a("button",{onClick:()=>{var u;return(u=N.current)==null?void 0:u.click()},className:"select-file-btn",children:[e(tt,{size:20}),h?"Change Image":"Select Image"]}),h&&a("button",{onClick:D,className:"upload-submit-btn",children:[e(dt,{size:20}),"Upload & Share"]}),e("button",{onClick:()=>{i(!1),g(null),I(null),N.current&&(N.current.value="")},className:"cancel-btn",children:"Cancel"})]})]}):a("div",{className:"share-invitation",children:[e(wa,{className:"heart-icon",size:32}),e("h3",{children:"Love creating Yumi art?"}),e("p",{children:"We'd love to see your original artwork! Share your creations with our community and earn rewards."}),a("div",{className:"reward-info",children:[a("div",{className:"reward-item",children:[e("span",{className:"reward-icon",children:"🎁"}),a("span",{className:"reward-text",children:[e("strong",{children:"1000 timeshards"})," for approved artwork"]})]}),a("div",{className:"reward-item",children:[e("span",{className:"reward-icon",children:"💫"}),a("span",{className:"reward-text",children:[e("strong",{children:"+500 bonus"})," for your first contribution"]})]}),a("div",{className:"reward-item",children:[e("span",{className:"reward-icon",children:"⭐"}),a("span",{className:"reward-text",children:[e("strong",{children:"+250 bonus"})," for exceptional quality"]})]})]}),a("button",{onClick:()=>i(!0),className:"share-btn",children:[e(dt,{size:20}),"Share Your Original Art"]})]})]}),e("div",{className:"legal-disclaimer",children:e("small",{children:rn})}),f&&e("div",{className:"preview-modal-overlay",onClick:()=>w(null),children:a("div",{className:"preview-modal",onClick:u=>u.stopPropagation(),children:[a("div",{className:"preview-header",children:[e("h3",{children:f.title}),e("button",{onClick:()=>w(null),className:"close-button",children:e(Ce,{size:20})})]}),a("div",{className:"preview-content",children:[e("img",{src:f.src,alt:f.title,className:"preview-full-image"}),a("div",{className:"preview-details",children:[e("p",{children:f.description}),e("div",{className:"preview-tags",children:f.tags.map(u=>e("span",{className:"tag",children:u},u))}),a("button",{onClick:()=>B(f),className:"use-reference-btn",children:[e(tt,{size:20}),"Use as Reference"]})]})]})]})})]})})},on=({library:t,onSelect:n,onSave:r,onDelete:i,onDuplicate:h,onVersionSelect:g,onClose:m,currentCharacter:p})=>{const[f,w]=o.useState(!1),[P,I]=o.useState(""),[N,R]=o.useState(""),[D,B]=o.useState(null),[S,E]=o.useState("grid"),[u,b]=o.useState("");o.useRef(null);const x=()=>{P.trim()&&(r(P.trim(),N.trim()),I(""),R(""),w(!1))},d=(s,C)=>{s.dataTransfer.setData("application/json",JSON.stringify(C)),s.dataTransfer.effectAllowed="copy"},c=t.filter(s=>u?s.tags.some(C=>C.toLowerCase().includes(u.toLowerCase())):!0),y=Array.from(new Set(t.flatMap(s=>s.tags)));return a("div",{className:"character-library",children:[a("div",{className:"library-header",children:[e("h3",{children:"🎭 Character Library"}),a("div",{className:"header-actions",children:[a("button",{className:"save-btn",onClick:()=>w(!0),title:"Save Current Character",children:[e(gt,{})," Save Current"]}),e("button",{className:"close-btn",onClick:m,children:e(Ce,{})})]})]}),a("div",{className:"library-controls",children:[e("div",{className:"filter-section",children:a("select",{value:u,onChange:s=>b(s.target.value),className:"filter-select",children:[e("option",{value:"",children:"All Tags"}),y.map(s=>e("option",{value:s,children:s},s))]})}),a("div",{className:"view-controls",children:[e("button",{className:S==="grid"?"active":"",onClick:()=>E("grid"),children:"Grid"}),e("button",{className:S==="list"?"active":"",onClick:()=>E("list"),children:"List"})]})]}),e("div",{className:`library-content ${S}`,children:c.map(s=>a("div",{className:`library-item ${(p==null?void 0:p.id)===s.id?"active":""}`,draggable:!0,onDragStart:C=>d(C,s),onClick:()=>B(s),children:[a("div",{className:"item-thumbnail",children:[e("img",{src:s.thumbnail,alt:s.name}),a("div",{className:"version-indicator",children:[s.versions.length," versions"]})]}),a("div",{className:"item-info",children:[e("h4",{children:s.name}),e("div",{className:"item-tags",children:s.tags.map(C=>e("span",{className:"tag",children:C},C))}),e("div",{className:"item-date",children:new Date(s.lastModified).toLocaleDateString()})]}),a("div",{className:"item-actions",children:[e("button",{onClick:C=>{C.stopPropagation(),n(s)},title:"Load Character",children:e(Oe,{})}),e("button",{onClick:C=>{C.stopPropagation(),h(s)},title:"Duplicate",children:e(Ft,{})}),e("button",{onClick:C=>{C.stopPropagation(),i(s.id)},title:"Delete",className:"delete-btn",children:e(_e,{})})]})]},s.id))}),D&&e("div",{className:"character-detail-modal",children:a("div",{className:"modal-content",children:[a("div",{className:"modal-header",children:[e("h3",{children:D.name}),e("button",{onClick:()=>B(null),children:e(Ce,{})})]}),a("div",{className:"versions-section",children:[a("h4",{children:["Versions (",D.versions.length,")"]}),e("div",{className:"versions-grid",children:D.versions.map(s=>a("div",{className:`version-item ${s.id===D.activeVersionId?"active":""}`,onClick:()=>g(D.id,s.id),children:[e("img",{src:s.thumbnail,alt:s.name}),a("div",{className:"version-info",children:[e("span",{className:"version-name",children:s.name}),e("span",{className:"version-date",children:new Date(s.timestamp).toLocaleDateString()})]})]},s.id))})]})]})}),f&&e("div",{className:"save-dialog-overlay",children:a("div",{className:"save-dialog",children:[e("h3",{children:"Save Character"}),a("div",{className:"form-group",children:[e("label",{children:"Character Name"}),e("input",{type:"text",value:P,onChange:s=>I(s.target.value),placeholder:"Enter character name...",autoFocus:!0})]}),a("div",{className:"form-group",children:[e("label",{children:"Description (Optional)"}),e("textarea",{value:N,onChange:s=>R(s.target.value),placeholder:"Add a description...",rows:3})]}),a("div",{className:"dialog-actions",children:[e("button",{onClick:()=>w(!1),children:"Cancel"}),e("button",{onClick:x,disabled:!P.trim(),children:"Save Character"})]})]})})]})},ln=({onColorSelect:t,onPaletteSelect:n,currentImage:r,onAnalyze:i})=>{const[h,g]=o.useState(!1),[m,p]=o.useState(null),[f,w]=o.useState([]),[P,I]=o.useState("all"),[N,R]=o.useState(null),D=o.useRef(null),B=d=>{var y;const c=(y=d.target.files)==null?void 0:y[0];if(c){const s=new FileReader;s.onload=C=>{var F;const T=(F=C.target)==null?void 0:F.result;R(T),S(T)},s.readAsDataURL(c)}},S=async d=>{g(!0);try{const c=await i(d);p(c),E(c)}catch(c){console.error("Failed to analyze image:",c)}finally{g(!1)}},E=d=>{const c=[];d.dominantColors.forEach((y,s)=>{c.push({color:y,reason:`Dominant color ${s+1} from your image`,category:"base",compatibility:95-s*5})}),d.recommendations.accentColors.forEach((y,s)=>{c.push({color:y,reason:`${d.colorHarmony} harmony accent`,category:"accent",compatibility:90-s*3})}),d.recommendations.hairColor.forEach((y,s)=>{c.push({color:y,reason:"Hair color suggestion",category:"highlight",compatibility:85-s*2})}),d.dominantColors.forEach(y=>{const s=u(y,-30);c.push({color:s,reason:"Shadow variant for depth",category:"shadow",compatibility:80})}),w(c)},u=(d,c)=>{const y=d.replace("#",""),s=parseInt(y,16),C=Math.max(0,Math.min(255,(s>>16)+c)),T=Math.max(0,Math.min(255,(s>>8&255)+c)),F=Math.max(0,Math.min(255,(s&255)+c));return`#${(C<<16|T<<8|F).toString(16).padStart(6,"0")}`},b=P==="all"?f:f.filter(d=>d.category===P),x=[{id:"maid_cafe",name:"Maid Café",colors:["#1a1a2e","#16213e","#0f3460","#533483","#7209b7"],category:"theme",theme:"maid_cafe"},{id:"sakura_spring",name:"Sakura Spring",colors:["#ffb7c5","#ffc0cb","#ff69b4","#ff1493","#c71585"],category:"pastel"},{id:"ocean_breeze",name:"Ocean Breeze",colors:["#4facfe","#00f2fe","#43e97b","#38f9d7","#667eea"],category:"cool"},{id:"sunset_warm",name:"Sunset Warm",colors:["#ff6b9d","#c44569","#f8b500","#feca57","#ff9ff3"],category:"warm"},{id:"gothic_dark",name:"Gothic Dark",colors:["#1a1a2e","#16213e","#533483","#7209b7","#2d1b69"],category:"theme",theme:"gothic"}];return a("div",{className:"ai-color-assistant",children:[a("div",{className:"assistant-header",children:[e("h3",{children:"🎨 AI Color Assistant"}),a("div",{className:"header-actions",children:[a("button",{onClick:()=>{var d;return(d=D.current)==null?void 0:d.click()},className:"upload-btn",disabled:h,children:[e(xa,{})," Upload Reference"]}),(r||N)&&a("button",{onClick:()=>S(r||N),className:"analyze-btn",disabled:h,children:[e(Be,{})," ",h?"Analyzing...":"Re-analyze"]})]})]}),e("input",{ref:D,type:"file",accept:"image/*",onChange:B,style:{display:"none"}}),h&&a("div",{className:"analysis-status",children:[e("div",{className:"loading-spinner"}),e("span",{children:"Analyzing colors and harmony..."})]}),(N||r)&&a("div",{className:"image-preview",children:[e("img",{src:N||r,alt:"Reference"}),e("div",{className:"image-overlay",children:e(Oe,{})})]}),m&&a("div",{className:"analysis-results",children:[e("h4",{children:"🔍 Analysis Results"}),a("div",{className:"color-harmony",children:[e("span",{className:"harmony-label",children:"Color Harmony:"}),e("span",{className:"harmony-type",children:m.colorHarmony})]}),a("div",{className:"dominant-colors",children:[e("span",{className:"label",children:"Dominant Colors:"}),e("div",{className:"color-row",children:m.dominantColors.map((d,c)=>e("div",{className:"color-swatch",style:{backgroundColor:d},onClick:()=>t(d),title:d},c))})]})]}),f.length>0&&a("div",{className:"category-filter",children:[e("h4",{children:"🎯 AI Suggestions"}),e("div",{className:"filter-buttons",children:["all","base","accent","highlight","shadow"].map(d=>e("button",{className:P===d?"active":"",onClick:()=>I(d),children:d.charAt(0).toUpperCase()+d.slice(1)},d))})]}),b.length>0&&e("div",{className:"ai-suggestions",children:b.map((d,c)=>a("div",{className:"suggestion-item",onClick:()=>t(d.color),children:[e("div",{className:"suggestion-color",style:{backgroundColor:d.color}}),a("div",{className:"suggestion-info",children:[e("div",{className:"suggestion-reason",children:d.reason}),a("div",{className:"suggestion-meta",children:[e("span",{className:"category",children:d.category}),a("span",{className:"compatibility",children:[d.compatibility,"% match"]})]})]})]},c))}),a("div",{className:"predefined-palettes",children:[e("h4",{children:"🎨 Theme Palettes"}),e("div",{className:"palettes-grid",children:x.map(d=>a("div",{className:"palette-item",onClick:()=>n(d),children:[e("div",{className:"palette-colors",children:d.colors.map((c,y)=>e("div",{className:"palette-color",style:{backgroundColor:c}},y))}),e("div",{className:"palette-name",children:d.name})]},d.id))})]}),a("div",{className:"quick-actions",children:[e("button",{onClick:()=>{var d;return(d=navigator.clipboard)==null?void 0:d.writeText(JSON.stringify(m))},children:"Copy Analysis"}),e("button",{onClick:()=>w([]),children:"Clear Suggestions"})]})]})},cn=({settings:t,onSettingsChange:n,currentColor:r,onAutoFill:i,isActive:h,onToggle:g})=>{const[m,p]=o.useState(!1),[f,w]=o.useState(!1),P=S=>{n({...t,mode:S})},I=S=>{n({...t,sensitivity:S})},N=S=>{n({...t,blendStrength:S})},R=()=>{n({...t,preserveDetails:!t.preserveDetails})},D=[{id:"auto_fill",name:"Auto Fill",icon:e(ka,{}),description:"Automatically fills detected regions with color",features:["Region detection","Smart boundaries","Color preservation"]},{id:"gradient_fill",name:"Gradient Fill",icon:e(Be,{}),description:"Creates intelligent gradients based on lighting and form",features:["Light analysis","Form following","Natural transitions"]},{id:"pattern_recognition",name:"Pattern Recognition",icon:e(Dt,{}),description:"Detects and fills patterns like clothes folds, hair strands",features:["Pattern recognition","Texture matching","Detail enhancement"]}],B=[{name:"Clothing",config:{mode:"auto_fill",sensitivity:75,blendStrength:85,preserveDetails:!0,detailLevel:"medium",edgeDetection:!0,colorBlending:"smooth"},description:"Optimized for coloring clothes and fabric"},{name:"Hair",config:{mode:"pattern_recognition",sensitivity:60,blendStrength:70,preserveDetails:!0,detailLevel:"fine",edgeDetection:!0,colorBlending:"textured"},description:"Perfect for hair strands and texture"},{name:"Skin",config:{mode:"gradient_fill",sensitivity:85,blendStrength:90,preserveDetails:!0,detailLevel:"ultra-fine",edgeDetection:!0,colorBlending:"smooth"},description:"Natural skin tones and shading"},{name:"Accessories",config:{mode:"auto_fill",sensitivity:90,blendStrength:95,preserveDetails:!1,detailLevel:"coarse",edgeDetection:!1,colorBlending:"crisp"},description:"Clean fills for jewelry and accessories"}];return a("div",{className:"smart-brush-panel",children:[a("div",{className:"panel-header",children:[a("div",{className:"header-left",children:[e("h3",{children:"🎨 Smart Brush"}),a("button",{className:`toggle-btn ${h?"active":""}`,onClick:g,title:h?"Disable Smart Brush":"Enable Smart Brush",children:[e(Me,{}),h?"ON":"OFF"]})]}),e("button",{className:"settings-btn",onClick:()=>p(!m),title:"Advanced Settings",children:e(Rt,{})})]}),h&&a(sa,{children:[a("div",{className:"mode-selection",children:[e("h4",{children:"Brush Mode"}),e("div",{className:"mode-grid",children:D.map(S=>a("div",{className:`mode-card ${t.mode===S.id?"active":""}`,onClick:()=>P(S.id),children:[e("div",{className:"mode-icon",children:S.icon}),a("div",{className:"mode-info",children:[e("div",{className:"mode-name",children:S.name}),e("div",{className:"mode-description",children:S.description}),e("div",{className:"mode-features",children:S.features.map(E=>e("span",{className:"feature-tag",children:E},E))})]})]},S.id))})]}),a("div",{className:"preset-section",children:[e("h4",{children:"Quick Presets"}),e("div",{className:"preset-grid",children:B.map(S=>e("button",{className:"preset-btn",onClick:()=>n(S.config),title:S.description,children:S.name},S.name))})]}),a("div",{className:"main-controls",children:[e("div",{className:"control-group",children:a("label",{children:["Sensitivity: ",t.sensitivity,"%",a("div",{className:"slider-container",children:[e("input",{type:"range",min:"0",max:"100",value:t.sensitivity,onChange:S=>I(parseInt(S.target.value)),className:"slider"}),a("div",{className:"slider-labels",children:[e("span",{children:"Loose"}),e("span",{children:"Precise"})]})]})]})}),e("div",{className:"control-group",children:a("label",{children:["Blend Strength: ",t.blendStrength,"%",a("div",{className:"slider-container",children:[e("input",{type:"range",min:"0",max:"100",value:t.blendStrength,onChange:S=>N(parseInt(S.target.value)),className:"slider"}),a("div",{className:"slider-labels",children:[e("span",{children:"Subtle"}),e("span",{children:"Strong"})]})]})]})}),e("div",{className:"control-group",children:a("label",{className:"checkbox-label",children:[e("input",{type:"checkbox",checked:t.preserveDetails,onChange:R}),e("span",{className:"checkmark"}),"Preserve Fine Details"]})})]}),m&&a("div",{className:"advanced-settings",children:[e("h4",{children:"Advanced Settings"}),a("div",{className:"advanced-grid",children:[a("div",{className:"setting-item",children:[e("label",{children:"Edge Detection"}),a("select",{defaultValue:"canny",children:[e("option",{value:"canny",children:"Canny"}),e("option",{value:"sobel",children:"Sobel"}),e("option",{value:"prewitt",children:"Prewitt"})]})]}),a("div",{className:"setting-item",children:[e("label",{children:"Color Space"}),a("select",{defaultValue:"lab",children:[e("option",{value:"rgb",children:"RGB"}),e("option",{value:"lab",children:"LAB"}),e("option",{value:"hsv",children:"HSV"})]})]}),a("div",{className:"setting-item",children:[e("label",{children:"Smoothing"}),e("input",{type:"range",min:"0",max:"10",defaultValue:"3"})]}),a("div",{className:"setting-item",children:[e("label",{children:"Threshold"}),e("input",{type:"range",min:"0",max:"255",defaultValue:"128"})]})]})]}),a("div",{className:"color-preview",children:[a("div",{className:"preview-header",children:[e("span",{children:"Current Color"}),e("button",{className:`preview-toggle ${f?"active":""}`,onClick:()=>w(!f),children:"Preview Mode"})]}),e("div",{className:"color-display",style:{backgroundColor:r},children:e("span",{className:"color-value",children:r})})]}),a("div",{className:"action-buttons",children:[a("button",{className:"action-btn primary",onClick:()=>i({mode:t.mode,color:r}),children:[e(Be,{}),"Apply Smart Fill"]}),a("button",{className:"action-btn secondary",children:[e(Dt,{}),"Analyze Region"]})]}),a("div",{className:"tips-section",children:[e("h5",{children:"💡 Tips"}),a("ul",{children:[a("li",{children:["Use ",e("strong",{children:"Auto Fill"})," for large, uniform areas"]}),a("li",{children:["Try ",e("strong",{children:"Pattern Recognition"})," for textured surfaces"]}),a("li",{children:["Enable ",e("strong",{children:"Preview Mode"})," to see changes before applying"]}),e("li",{children:"Lower sensitivity for more precise edge detection"})]})]})]})]})},dn=({history:t,onRevert:n,onSaveVersion:r,onDeleteVersion:i,onCompareVersions:h,currentCanvasData:g})=>{const[m,p]=o.useState(!1),[f,w]=o.useState(""),[P,I]=o.useState(""),[N,R]=o.useState([]),[D,B]=o.useState("timeline"),S=t.versions[t.currentIndex],E=t.currentIndex>0,u=t.currentIndex<t.versions.length-1,b=()=>{f.trim()&&(r(f.trim(),P.trim()),w(""),I(""),p(!1))},x=s=>{N.includes(s)?R(C=>C.filter(T=>T!==s)):N.length<2?R(C=>[...C,s]):R([s])},d=()=>{N.length===2&&h(N[0],N[1])},c=s=>{const T=Date.now()-s,F=Math.floor(T/6e4),W=Math.floor(T/36e5),V=Math.floor(T/864e5);return V>0?`${V} day${V>1?"s":""} ago`:W>0?`${W} hour${W>1?"s":""} ago`:F>0?`${F} minute${F>1?"s":""} ago`:"Just now"},y=()=>{const s=t.versions.length+1,T=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return`Version ${s} - ${T}`};return a("div",{className:"version-history",children:[a("div",{className:"history-header",children:[e("h3",{children:"📚 Version History"}),a("div",{className:"header-actions",children:[e("button",{onClick:()=>B(D==="timeline"?"grid":"timeline"),className:"view-toggle",title:`Switch to ${D==="timeline"?"grid":"timeline"} view`,children:D==="timeline"?"📋":"📅"}),a("button",{onClick:()=>p(!0),className:"save-btn",title:"Save Current Version",children:[e(Et,{})," Save"]})]})]}),a("div",{className:"navigation-controls",children:[e("button",{onClick:()=>{var s;return n((s=t.versions[t.currentIndex-1])==null?void 0:s.id)},disabled:!E,className:"nav-btn",title:"Go to previous version",children:e(Re,{})}),a("div",{className:"current-version-info",children:[a("span",{className:"version-indicator",children:[t.currentIndex+1," of ",t.versions.length]}),S&&e("span",{className:"version-name",children:S.name})]}),e("button",{onClick:()=>{var s;return n((s=t.versions[t.currentIndex+1])==null?void 0:s.id)},disabled:!u,className:"nav-btn",title:"Go to next version",children:e(Ae,{})})]}),N.length>0&&e("div",{className:"compare-section",children:a("div",{className:"compare-header",children:[a("span",{children:[N.length,"/2 selected for comparison"]}),N.length===2&&e("button",{onClick:d,className:"compare-btn",children:"Compare Versions"}),e("button",{onClick:()=>R([]),className:"clear-selection",children:"Clear"})]})}),e("div",{className:`versions-container ${D}`,children:D==="timeline"?e("div",{className:"timeline",children:t.versions.map((s,C)=>a("div",{className:`timeline-item ${C===t.currentIndex?"current":""} ${N.includes(s.id)?"selected":""}`,onClick:()=>x(s.id),children:[e("div",{className:"timeline-marker",children:C===t.currentIndex&&e("div",{className:"current-indicator"})}),a("div",{className:"timeline-content",children:[e("div",{className:"version-thumbnail",children:e("img",{src:s.thumbnail,alt:s.name})}),a("div",{className:"version-details",children:[e("h4",{children:s.name}),s.description&&e("p",{className:"version-description",children:s.description}),a("div",{className:"version-metadata",children:[a("span",{className:"timestamp",children:[e(mt,{}),c(s.timestamp)]}),s.metadata&&a("div",{className:"metadata-tags",children:[s.metadata.pose&&a("span",{className:"tag",children:["Pose: ",s.metadata.pose]}),s.metadata.expression&&a("span",{className:"tag",children:["Expression: ",s.metadata.expression]})]})]}),a("div",{className:"version-actions",children:[e("button",{onClick:T=>{T.stopPropagation(),n(s.id)},className:"action-btn revert",title:"Revert to this version",children:"Revert"}),e("button",{onClick:T=>{var F;T.stopPropagation(),(F=navigator.clipboard)==null||F.writeText(s.canvasData)},className:"action-btn copy",title:"Copy version data",children:e(Ft,{})}),C!==t.currentIndex&&e("button",{onClick:T=>{T.stopPropagation(),i(s.id)},className:"action-btn delete",title:"Delete this version",children:e(_e,{})})]})]})]})]},s.id))}):e("div",{className:"grid-view",children:t.versions.map((s,C)=>a("div",{className:`grid-item ${C===t.currentIndex?"current":""} ${N.includes(s.id)?"selected":""}`,onClick:()=>x(s.id),children:[a("div",{className:"grid-thumbnail",children:[e("img",{src:s.thumbnail,alt:s.name}),C===t.currentIndex&&e("div",{className:"current-badge",children:"Current"})]}),a("div",{className:"grid-info",children:[e("h5",{children:s.name}),e("span",{className:"grid-timestamp",children:c(s.timestamp)})]}),a("div",{className:"grid-actions",children:[e("button",{onClick:T=>{T.stopPropagation(),n(s.id)},title:"Revert",children:"↶"}),C!==t.currentIndex&&e("button",{onClick:T=>{T.stopPropagation(),i(s.id)},className:"delete-grid",title:"Delete",children:"×"})]})]},s.id))})}),a("div",{className:"history-stats",children:[a("div",{className:"stat-item",children:[e("span",{className:"stat-value",children:t.versions.length}),e("span",{className:"stat-label",children:"Total Versions"})]}),a("div",{className:"stat-item",children:[a("span",{className:"stat-value",children:[Math.round(t.versions.length/t.maxVersions*100),"%"]}),e("span",{className:"stat-label",children:"Storage Used"})]})]}),m&&e("div",{className:"save-dialog-overlay",children:a("div",{className:"save-dialog",children:[e("h3",{children:"Save New Version"}),a("div",{className:"form-group",children:[e("label",{children:"Version Name"}),e("input",{type:"text",value:f,onChange:s=>w(s.target.value),placeholder:y(),autoFocus:!0})]}),a("div",{className:"form-group",children:[e("label",{children:"Description (Optional)"}),e("textarea",{value:P,onChange:s=>I(s.target.value),placeholder:"Describe what changed in this version...",rows:3})]}),a("div",{className:"dialog-actions",children:[e("button",{onClick:()=>p(!1),children:"Cancel"}),e("button",{onClick:b,className:"primary",children:"Save Version"})]})]})})]})},G=(t={})=>({size:5,opacity:100,hardness:80,tipShape:"round",pressureSensitivity:!1,spacing:25,scattering:0,rotation:0,flowRate:100,smoothing:0,tapering:{enabled:!1,startTaper:0,endTaper:0},...t}),Vt=[{id:"basic-brush",name:"Basic Brush",tool:"brush",category:"basic",description:"Standard brush for general drawing",icon:"🖌️",minSize:1,maxSize:100,supportsTexture:!0,supportsPressure:!0,defaultSettings:G({size:10,opacity:80,hardness:70,pressureSensitivity:!0})},{id:"pencil",name:"Pencil",tool:"pencil",category:"basic",description:"Traditional pencil for sketching",icon:"✏️",minSize:.5,maxSize:20,supportsTexture:!0,supportsPressure:!0,defaultSettings:G({size:2,opacity:60,hardness:90,pressureSensitivity:!0,spacing:15,texturePath:"/textures/pencil-grain.png"})},{id:"marker",name:"Marker",tool:"marker",category:"basic",description:"Smooth marker for bold strokes",icon:"🖊️",minSize:3,maxSize:50,supportsTexture:!1,supportsPressure:!1,defaultSettings:G({size:15,opacity:70,hardness:30,tipShape:"diagonal",flowRate:80})},{id:"airbrush",name:"Airbrush",tool:"airbrush",category:"basic",description:"Soft airbrush for gradual shading",icon:"💨",minSize:5,maxSize:200,supportsTexture:!1,supportsPressure:!0,defaultSettings:G({size:30,opacity:30,hardness:0,pressureSensitivity:!0,flowRate:50,smoothing:80})},{id:"fine-liner",name:"Fine Liner",tool:"fine-liner",category:"detail",description:"Ultra-precise tool for eyelashes, hair strands, and fine details",icon:"🖋️",minSize:.1,maxSize:3,supportsTexture:!1,supportsPressure:!0,defaultSettings:G({size:.5,opacity:95,hardness:95,pressureSensitivity:!0,spacing:5,smoothing:20,tapering:{enabled:!0,startTaper:10,endTaper:30}})},{id:"detail-brush",name:"Detail Brush",tool:"detail-brush",category:"detail",description:"Small brush for tiny highlights and micro-details",icon:"✨",minSize:.2,maxSize:8,supportsTexture:!0,supportsPressure:!0,defaultSettings:G({size:1.5,opacity:85,hardness:80,pressureSensitivity:!0,spacing:20,smoothing:40})},{id:"calligraphy",name:"Calligraphy Pen",tool:"calligraphy",category:"detail",description:"Variable width pen that responds to stroke direction and pressure",icon:"🖋️",minSize:.5,maxSize:20,supportsTexture:!1,supportsPressure:!0,defaultSettings:G({size:8,opacity:90,hardness:85,tipShape:"diagonal",pressureSensitivity:!0,spacing:10,tapering:{enabled:!0,startTaper:20,endTaper:20}})},{id:"pixel-brush",name:"Pixel Brush",tool:"pixel-brush",category:"detail",description:"Perfect for pixel-art style details and crisp edges",icon:"⬛",minSize:1,maxSize:10,supportsTexture:!1,supportsPressure:!1,defaultSettings:G({size:1,opacity:100,hardness:100,tipShape:"square",spacing:100,smoothing:0})},{id:"texture-brush",name:"Texture Brush",tool:"texture-brush",category:"texture",description:"Specialized for hair texture, fabric patterns, and surface details",icon:"🌾",minSize:3,maxSize:50,supportsTexture:!0,supportsPressure:!0,defaultSettings:G({size:12,opacity:60,hardness:60,pressureSensitivity:!0,spacing:40,scattering:20,rotation:15,texturePath:"/textures/hair-texture.png"})},{id:"basic-eraser",name:"Basic Eraser",tool:"eraser",category:"basic",description:"Standard eraser for general corrections",icon:"🗑️",minSize:2,maxSize:100,supportsTexture:!1,supportsPressure:!0,defaultSettings:G({size:15,opacity:100,hardness:70,pressureSensitivity:!0})},{id:"precision-eraser",name:"Precision Eraser",tool:"precision-eraser",category:"detail",description:"Ultra-precise eraser for detailed corrections",icon:"🎯",minSize:.5,maxSize:10,supportsTexture:!1,supportsPressure:!0,defaultSettings:G({size:2,opacity:100,hardness:90,pressureSensitivity:!0,spacing:10})},{id:"soft-eraser",name:"Soft Eraser",tool:"soft-eraser",category:"effects",description:"Gradual eraser for smooth blending and soft corrections",icon:"☁️",minSize:5,maxSize:100,supportsTexture:!1,supportsPressure:!0,defaultSettings:G({size:25,opacity:50,hardness:20,pressureSensitivity:!0,flowRate:60,smoothing:60})},{id:"highlight-eraser",name:"Highlight Eraser",tool:"highlight-eraser",category:"effects",description:"Creates highlights and light effects by selective erasing",icon:"⭐",minSize:1,maxSize:30,supportsTexture:!0,supportsPressure:!0,defaultSettings:G({size:8,opacity:80,hardness:60,pressureSensitivity:!0,spacing:30,tapering:{enabled:!0,startTaper:0,endTaper:50}})}],nt=t=>Vt.find(n=>n.id===t),rt={settings:G({size:.3,opacity:90,hardness:95,pressureSensitivity:!0,spacing:3,smoothing:15,tapering:{enabled:!0,startTaper:5,endTaper:40}})},it={settings:G({size:2,opacity:70,hardness:80,pressureSensitivity:!0,spacing:15,scattering:10,tapering:{enabled:!0,startTaper:0,endTaper:20}})};G({size:1,opacity:95,hardness:70,pressureSensitivity:!0,spacing:25,smoothing:30});const un=({onBack:t,uploadedFiles:n,onFileUpload:r,selectedReferenceUrl:i,backgroundSettings:h,showCustomization:g,onCustomizeToggle:m,showYumiReferences:p,setShowYumiReferences:f,onYumiReferenceSelect:w})=>{var wt;const{user:P}=_t(),[I,N]=o.useState("layers"),[R,D]=o.useState("brush"),[B,S]=o.useState(((wt=nt("basic-brush"))==null?void 0:wt.defaultSettings)||{size:5,opacity:100,hardness:80,tipShape:"round",pressureSensitivity:!1,spacing:25,scattering:0,rotation:0,flowRate:100,smoothing:0,tapering:{enabled:!1,startTaper:0,endTaper:0}}),[E,u]=o.useState(null),[b,x]=o.useState(ut[0]),[d,c]=o.useState({characterLibrary:[],versionHistory:{versions:[],currentIndex:-1,maxVersions:20},showSmallWindow:!1,aiColorSuggestions:[],recommendedCombinations:[],smartBrushSettings:{mode:"auto_fill",sensitivity:75,blendStrength:85,preserveDetails:!0,detailLevel:"medium",edgeDetection:!0,colorBlending:"smooth"}}),[y,s]=o.useState(!1),[C,T]=o.useState(!1),[F,W]=o.useState(!1),[V,ae]=o.useState(!1),[k,X]=o.useState(!1),[_,le]=o.useState(Da("image",{level:"balanced",yumiPersonality:"otaku",allowSuggestions:!0,memoryNudges:!0,iterativeMode:!0})),[ge,ze]=o.useState(!1),[Ie,St]=o.useState([]),[Ye]=o.useState(Pa()),[fe,ve]=o.useState({name:"",age:"",background:"",catchphrase:"",personalityTraits:[],visualMotifs:[],designElements:[]}),[U,ne]=o.useState({zoom:1,position:{x:0,y:0},tool:"brush",color:"#000000",size:5,opacity:100,blendMode:"normal",layers:[],activeLayerId:"base",hasDrawing:!1}),[Q,we]=o.useState([{id:"base",name:"Base Layer",canvas:document.createElement("canvas"),visible:!0,opacity:100,blendMode:"normal",locked:!1}]),[ye,xe]=o.useState("base");o.useRef(null);const[ke,he]=o.useState(!1),[Ge,We]=o.useState({x:0,y:0});o.useEffect(()=>{P&&A()},[P]);const be=l=>{const v=nt(l)||nt("basic-brush");v&&(D(l),S(v.defaultSettings),ne(z=>({...z,tool:l,size:v.defaultSettings.size,opacity:v.defaultSettings.opacity})))},Xe=()=>{D("fine-liner"),S(rt.settings),ne(l=>({...l,tool:"fine-liner",size:rt.settings.size,opacity:rt.settings.opacity}))},je=()=>{D("texture-brush"),S(it.settings),ne(l=>({...l,tool:"texture-brush",size:it.settings.size,opacity:it.settings.opacity}))},qe=l=>{const v=_.controlSettings;le(z=>({...z,controlSettings:l})),l.yumiPersonality!==v.yumiPersonality&&le(z=>Ia(z,{lastUsedPersonality:l.yumiPersonality}))},Je=l=>{const v=Ie.find(z=>z.id===l);if(v&&typeof v.content=="string"&&v.content.startsWith("data:image")){const z=new Image;z.onload=()=>{const O=Q.find(J=>J.id===ye);if(O){const J=O.canvas.getContext("2d");J&&(J.clearRect(0,0,O.canvas.width,O.canvas.height),J.drawImage(z,0,0),Ct(ye,O.canvas))}},z.src=v.content}},M=l=>{if(_.controlSettings.level==="balanced"||_.controlSettings.allowSuggestions){const v=pe();Ta.generateBasePrompt(`Refine this image based on feedback: ${l.question}`,_.controlSettings),l.type==="style"||l.type==="mood"?T(!0):l.type==="detail"&&W(!0),le(z=>({...z,currentContext:{feedback:l,canvasData:v}}))}},L=async()=>{if(_.controlSettings.iterativeMode){const l=pe(),v=[{id:`version_${Date.now()}_main`,type:"main",content:l,metadata:{aiConfidence:.8,refinementsSuggested:["Add more detail","Adjust colors","Refine pose"],personalityInfluence:[_.controlSettings.yumiPersonality]}}];_.controlSettings.allowSuggestions&&v.push({id:`version_${Date.now()}_alt`,type:"alternative",content:l,metadata:{aiConfidence:.7,refinementsSuggested:["Different style approach","Color variation"],personalityInfluence:[_.controlSettings.yumiPersonality]}}),St(v),ze(!0)}},A=async()=>{try{const l=await Ne.get("/api/anime-helper/characters");c(v=>({...v,characterLibrary:l.data}))}catch(l){console.error("Failed to load character library:",l)}},j=async(l,v)=>{try{const z=pe(),O={name:l,thumbnail:z,tags:Qt(),createdAt:Date.now(),lastModified:Date.now(),versions:[{id:et(),name:"Initial Version",thumbnail:z,timestamp:Date.now(),description:v,canvasData:Ze(),metadata:{pose:b.name,colors:[U.color]}}],activeVersionId:""},J=await Ne.post("/api/anime-helper/characters",O);c(xt=>({...xt,characterLibrary:[...xt.characterLibrary,J.data]}))}catch(z){console.error("Failed to save character:",z)}},oe=l=>{const v=l.versions.find(z=>z.id===l.activeVersionId)||l.versions[0];v&&(Qe(v.canvasData),c(z=>({...z,currentCharacter:l})))},H=(l,v)=>{const z=pe(),O={id:et(),name:l||`Version ${d.versionHistory.versions.length+1}`,thumbnail:z,timestamp:Date.now(),description:v,canvasData:Ze(),metadata:{pose:b.name,colors:[U.color]}};c(J=>({...J,versionHistory:{...J.versionHistory,versions:[...J.versionHistory.versions,O],currentIndex:J.versionHistory.versions.length}}))},ce=l=>{const v=d.versionHistory.versions.find(z=>z.id===l);if(v){Qe(v.canvasData);const z=d.versionHistory.versions.findIndex(O=>O.id===l);c(O=>({...O,versionHistory:{...O.versionHistory,currentIndex:z}}))}},Ke=async l=>{try{return(await Ne.post("/api/anime-helper/analyze-colors",{imageData:l})).data}catch(v){return console.error("Failed to analyze colors:",v),{dominantColors:["#ff6b9d","#667eea","#4facfe"],colorHarmony:"complementary",suggestedPalettes:[],styleCategory:"anime",recommendations:{hairColor:["#8b4513","#ff69b4"],accentColors:["#ffd700","#32cd32"],backgroundSuggestions:["#e6f3ff","#fff0f5"]}}}},Te=l=>{console.log("Smart brush auto-fill:",l)},De=l=>{if(s(!1),T(!1),W(!1),ae(!1),l==="character-library"){s(!0),N(null);return}else if(l==="ai-color-assistant"){T(!0),N(null);return}else if(l==="smart-brush"){W(!0),N(null);return}else if(l==="version-history"){ae(!0),N(null);return}N(l)},pe=()=>{const l=document.createElement("canvas");l.width=150,l.height=150;const v=l.getContext("2d");return v&&(v.fillStyle=U.color,v.fillRect(0,0,l.width,l.height)),l.toDataURL()},Ze=()=>JSON.stringify({canvasState:U,layers:Q.map(l=>({...l,canvas:l.canvas.toDataURL()})),characterData:fe,selectedPose:b,currentBrushSettings:B}),Qe=l=>{try{const v=JSON.parse(l);ne(v.canvasState),ve(v.characterData),x(v.selectedPose),v.currentBrushSettings&&S(v.currentBrushSettings)}catch(v){console.error("Failed to deserialize canvas state:",v)}},Qt=()=>{const l=[];return fe.personalityTraits.length>0&&l.push("personality"),b.name&&l.push("posed"),U.hasDrawing&&l.push("custom"),l},et=()=>Math.random().toString(36).substr(2,9),ea=()=>{const l={id:`layer-${Q.length+1}`,name:`Layer ${Q.length+1}`,canvas:document.createElement("canvas"),visible:!0,opacity:100,blendMode:"normal",locked:!1};we(v=>[...v,l])},Nt=(l,v)=>{we(z=>z.map(O=>O.id===l?{...O,...v}:O))},ta=l=>{l===ye&&Q.length>1&&xe(Q[0].id),we(v=>v.filter(z=>z.id!==l))},Ct=(l,v)=>{Nt(l,{canvas:v})},aa=l=>{ne(v=>({...v,...l}))},na=l=>{u(l.template),ve(v=>({...v,designElements:[...v.designElements,`Template: ${l.template.name}`]}))},ra=l=>{x(l),ve(v=>({...v,designElements:[...v.designElements,`Pose: ${l.name}`]}))},ia=()=>{switch(I){case"layers":return e(Ka,{layers:Q,activeLayerId:ye,onAddLayer:ea,onUpdateLayer:Nt,onDeleteLayer:ta,onSelectLayer:xe});case"palette":return e(Za,{color:U.color,onColorChange:l=>ne(v=>({...v,color:l}))});case"history":return e(Qa,{});case"export":return e(en,{});case"search":return e($t,{onSelect:l=>{console.log("Reference image selected:",l)},onClose:()=>N(null)});case"templates":return e(tn,{onComplete:na,designBrief:fe});case"poses":return e(an,{selectedPose:b,onPoseSelect:ra,onClose:()=>N(null)});default:return null}};return a("div",{className:"creation-mode",style:{paddingTop:"60px"},children:[e("div",{className:"creation-mode-header",style:{position:"fixed",top:0,left:0,right:0,height:"60px",backgroundColor:"#1a1a2e",color:"white",display:"flex",alignItems:"center",padding:"0 20px",zIndex:1e3,boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:a("button",{onClick:t,style:{background:"transparent",border:"none",color:"white",display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"16px"},children:[e(ht,{})," Back to Modes"]})}),e(Ja,{mode:"creative",context:I,setMode:()=>{},setContext:De,onBack:t,onToolChange:be,selectedTool:R,onCustomizeToggle:m,onFileUpload:r,onYumiRefsToggle:()=>f(!0),onCharacterLibraryToggle:()=>s(!y),onAIColorAssistantToggle:()=>T(!C),onSmartBrushToggle:()=>W(!F),onVersionHistoryToggle:()=>ae(!V)}),y&&e(on,{library:d.characterLibrary,onSelect:oe,onSave:j,onDelete:l=>{c(v=>({...v,characterLibrary:v.characterLibrary.filter(z=>z.id!==l)}))},onDuplicate:l=>{const v={...l,id:et(),name:`${l.name} Copy`};c(z=>({...z,characterLibrary:[...z.characterLibrary,v]}))},onVersionSelect:(l,v)=>{const z=d.characterLibrary.find(O=>O.id===l);if(z){const O=z.versions.find(J=>J.id===v);O&&Qe(O.canvasData)}},onClose:()=>s(!1),currentCharacter:d.currentCharacter}),C&&e("div",{className:"ai-color-assistant-container",style:{position:"fixed",top:"60px",right:"20px",zIndex:1e3},children:e(ln,{onColorSelect:l=>ne(v=>({...v,color:l})),onPaletteSelect:l=>{console.log("Palette selected:",l)},onAnalyze:Ke})}),F&&e("div",{className:"smart-brush-container",style:{position:"fixed",top:"60px",left:"20px",zIndex:1e3},children:e(cn,{settings:d.smartBrushSettings,onSettingsChange:l=>c(v=>({...v,smartBrushSettings:l})),currentColor:U.color,onAutoFill:Te,isActive:k,onToggle:()=>X(!k)})}),V&&e("div",{className:"version-history-container",style:{position:"fixed",top:"60px",left:"380px",zIndex:1e3},children:e(dn,{history:d.versionHistory,onRevert:ce,onSaveVersion:H,onDeleteVersion:l=>{c(v=>({...v,versionHistory:{...v.versionHistory,versions:v.versionHistory.versions.filter(z=>z.id!==l)}}))},onCompareVersions:(l,v)=>{console.log("Compare versions:",l,v)},currentCanvasData:Ze()})}),g&&a("div",{className:"customization-panel anime-customization",children:[e("h3",{children:"🎨 Creation Mode v1.2"}),a("div",{className:"customization-section",children:[e("h4",{children:"✨ Quick Brush Presets"}),a("div",{className:"quick-tools",children:[a("button",{onClick:Xe,className:"preset-btn",children:[e(Ot,{})," Eyelashes"]}),a("button",{onClick:je,className:"preset-btn",children:[e(Me,{})," Hair Strands"]})]})]}),a("div",{className:"customization-section",children:[a("h4",{children:["🖌️ Current Brush: ",R]}),a("div",{className:"brush-settings",children:[a("div",{className:"setting-item",children:[a("label",{children:["Size: ",B.size]}),e("input",{type:"range",min:"0.1",max:"100",step:"0.1",value:B.size,onChange:l=>{const v=parseFloat(l.target.value);S(z=>({...z,size:v})),ne(z=>({...z,size:v}))}})]}),a("div",{className:"setting-item",children:[a("label",{children:["Opacity: ",B.opacity,"%"]}),e("input",{type:"range",min:"1",max:"100",value:B.opacity,onChange:l=>{const v=parseInt(l.target.value);S(z=>({...z,opacity:v})),ne(z=>({...z,opacity:v}))}})]}),a("div",{className:"setting-item",children:[a("label",{children:["Hardness: ",B.hardness,"%"]}),e("input",{type:"range",min:"0",max:"100",value:B.hardness,onChange:l=>{const v=parseInt(l.target.value);S(z=>({...z,hardness:v}))}})]})]})]}),a("div",{className:"customization-section",children:[e("h4",{children:"🛠️ Tool Categories"}),e("div",{className:"tool-categories",children:a("div",{className:"category",children:[e("h5",{children:"Detail Tools"}),e("div",{className:"tool-grid",children:Vt.filter(l=>l.category==="detail").map(l=>a("button",{onClick:()=>be(l.id),className:R===l.tool?"active":"",title:l.description,children:[l.icon," ",l.name]},l.id))})]})})]}),a("div",{className:"customization-section",children:[e("h4",{children:"v1.2 Creation Tools"}),a("div",{className:"quick-tools",children:[a("button",{onClick:()=>s(!y),className:y?"active":"",children:[e(ct,{})," Library"]}),a("button",{onClick:()=>T(!C),className:C?"active":"",children:[e(pt,{})," AI Colors"]}),a("button",{onClick:()=>W(!F),className:F?"active":"",children:[e(Me,{})," Smart Brush"]}),a("button",{onClick:()=>ae(!V),className:V?"active":"",children:[e(mt,{})," History"]}),e("button",{onClick:L,className:"generate-versions-btn",children:"✨ Generate Versions"})]})]})]}),e(Ht,{mode:"creative",tool:R,color:U.color,size:U.size,opacity:U.opacity,blendMode:U.blendMode,zoom:U.zoom,position:U.position,layers:Q,activeLayerId:ye,onLayerChange:Ct,onStateChange:aa,smartBrushActive:k,smartBrushSettings:d.smartBrushSettings,brushSettings:B}),I&&e("div",{className:"context-panel",children:ia()}),p&&e(sn,{onClose:()=>f(!1),onSelect:w}),e(Ma,{currentSettings:_.controlSettings,onSettingsChange:qe,userHistory:_.userHistory,availablePersonalities:Ye,mode:"image"}),ge&&Ie.length>0&&e(za,{versions:Ie,onVersionSelect:Je,onRequestRefinement:M,currentPersonality:_.controlSettings.yumiPersonality,refinementSuggestions:["Softer expressions","Brighter colors","Add more detail","Simplify composition","Change pose","Adjust lighting"]})]})};var $e={exports:{}},Ut={};function Yt(t){var n,r,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t))for(n=0;n<t.length;n++)t[n]&&(r=Yt(t[n]))&&(i&&(i+=" "),i+=r);else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function Mt(){for(var t,n,r=0,i="";r<arguments.length;)(t=arguments[r++])&&(n=Yt(t))&&(i&&(i+=" "),i+=n);return i}const hn=Object.freeze(Object.defineProperty({__proto__:null,clsx:Mt,default:Mt},Symbol.toStringTag,{value:"Module"})),pn=ca(hn);var $={},ie={};Object.defineProperty(ie,"__esModule",{value:!0});ie.dontSetMe=yn;ie.findInArray=mn;ie.int=vn;ie.isFunction=gn;ie.isNum=fn;function mn(t,n){for(let r=0,i=t.length;r<i;r++)if(n.apply(n,[t[r],r,t]))return t[r]}function gn(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Function]"}function fn(t){return typeof t=="number"&&!isNaN(t)}function vn(t){return parseInt(t,10)}function yn(t,n,r){if(t[n])return new Error("Invalid prop ".concat(n," passed to ").concat(r," - do not set this, set it on the child."))}var me={};Object.defineProperty(me,"__esModule",{value:!0});me.browserPrefixToKey=Wt;me.browserPrefixToStyle=bn;me.default=void 0;me.getPrefix=Gt;const st=["Moz","Webkit","O","ms"];function Gt(){var t;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"transform";if(typeof window>"u")return"";const r=(t=window.document)===null||t===void 0||(t=t.documentElement)===null||t===void 0?void 0:t.style;if(!r||n in r)return"";for(let i=0;i<st.length;i++)if(Wt(n,st[i])in r)return st[i];return""}function Wt(t,n){return n?"".concat(n).concat(Sn(t)):t}function bn(t,n){return n?"-".concat(n.toLowerCase(),"-").concat(t):t}function Sn(t){let n="",r=!0;for(let i=0;i<t.length;i++)r?(n+=t[i].toUpperCase(),r=!1):t[i]==="-"?r=!0:n+=t[i];return n}me.default=Gt();Object.defineProperty($,"__esModule",{value:!0});$.addClassName=qt;$.addEvent=wn;$.addUserSelectStyles=An;$.createCSSTransform=In;$.createSVGTransform=Tn;$.getTouch=Ln;$.getTouchIdentifier=En;$.getTranslation=vt;$.innerHeight=Pn;$.innerWidth=Mn;$.matchesSelector=jt;$.matchesSelectorAndParentsTo=Cn;$.offsetXYFromParent=zn;$.outerHeight=kn;$.outerWidth=Dn;$.removeClassName=Jt;$.removeEvent=xn;$.removeUserSelectStyles=Rn;var te=ie,zt=Nn(me);function Xt(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,r=new WeakMap;return(Xt=function(i){return i?r:n})(t)}function Nn(t,n){if(t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=Xt(n);if(r&&r.has(t))return r.get(t);var i={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in t)if(g!=="default"&&Object.prototype.hasOwnProperty.call(t,g)){var m=h?Object.getOwnPropertyDescriptor(t,g):null;m&&(m.get||m.set)?Object.defineProperty(i,g,m):i[g]=t[g]}return i.default=t,r&&r.set(t,i),i}let Ee="";function jt(t,n){return Ee||(Ee=(0,te.findInArray)(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(r){return(0,te.isFunction)(t[r])})),(0,te.isFunction)(t[Ee])?t[Ee](n):!1}function Cn(t,n,r){let i=t;do{if(jt(i,n))return!0;if(i===r)return!1;i=i.parentNode}while(i);return!1}function wn(t,n,r,i){if(!t)return;const h={capture:!0,...i};t.addEventListener?t.addEventListener(n,r,h):t.attachEvent?t.attachEvent("on"+n,r):t["on"+n]=r}function xn(t,n,r,i){if(!t)return;const h={capture:!0,...i};t.removeEventListener?t.removeEventListener(n,r,h):t.detachEvent?t.detachEvent("on"+n,r):t["on"+n]=null}function kn(t){let n=t.clientHeight;const r=t.ownerDocument.defaultView.getComputedStyle(t);return n+=(0,te.int)(r.borderTopWidth),n+=(0,te.int)(r.borderBottomWidth),n}function Dn(t){let n=t.clientWidth;const r=t.ownerDocument.defaultView.getComputedStyle(t);return n+=(0,te.int)(r.borderLeftWidth),n+=(0,te.int)(r.borderRightWidth),n}function Pn(t){let n=t.clientHeight;const r=t.ownerDocument.defaultView.getComputedStyle(t);return n-=(0,te.int)(r.paddingTop),n-=(0,te.int)(r.paddingBottom),n}function Mn(t){let n=t.clientWidth;const r=t.ownerDocument.defaultView.getComputedStyle(t);return n-=(0,te.int)(r.paddingLeft),n-=(0,te.int)(r.paddingRight),n}function zn(t,n,r){const h=n===n.ownerDocument.body?{left:0,top:0}:n.getBoundingClientRect(),g=(t.clientX+n.scrollLeft-h.left)/r,m=(t.clientY+n.scrollTop-h.top)/r;return{x:g,y:m}}function In(t,n){const r=vt(t,n,"px");return{[(0,zt.browserPrefixToKey)("transform",zt.default)]:r}}function Tn(t,n){return vt(t,n,"")}function vt(t,n,r){let{x:i,y:h}=t,g="translate(".concat(i).concat(r,",").concat(h).concat(r,")");if(n){const m="".concat(typeof n.x=="string"?n.x:n.x+r),p="".concat(typeof n.y=="string"?n.y:n.y+r);g="translate(".concat(m,", ").concat(p,")")+g}return g}function Ln(t,n){return t.targetTouches&&(0,te.findInArray)(t.targetTouches,r=>n===r.identifier)||t.changedTouches&&(0,te.findInArray)(t.changedTouches,r=>n===r.identifier)}function En(t){if(t.targetTouches&&t.targetTouches[0])return t.targetTouches[0].identifier;if(t.changedTouches&&t.changedTouches[0])return t.changedTouches[0].identifier}function An(t){if(!t)return;let n=t.getElementById("react-draggable-style-el");n||(n=t.createElement("style"),n.type="text/css",n.id="react-draggable-style-el",n.innerHTML=`.react-draggable-transparent-selection *::-moz-selection {all: inherit;}
`,n.innerHTML+=`.react-draggable-transparent-selection *::selection {all: inherit;}
`,t.getElementsByTagName("head")[0].appendChild(n)),t.body&&qt(t.body,"react-draggable-transparent-selection")}function Rn(t){if(t)try{if(t.body&&Jt(t.body,"react-draggable-transparent-selection"),t.selection)t.selection.empty();else{const n=(t.defaultView||window).getSelection();n&&n.type!=="Caret"&&n.removeAllRanges()}}catch{}}function qt(t,n){t.classList?t.classList.add(n):t.className.match(new RegExp("(?:^|\\s)".concat(n,"(?!\\S)")))||(t.className+=" ".concat(n))}function Jt(t,n){t.classList?t.classList.remove(n):t.className=t.className.replace(new RegExp("(?:^|\\s)".concat(n,"(?!\\S)"),"g"),"")}var se={};Object.defineProperty(se,"__esModule",{value:!0});se.canDragX=_n;se.canDragY=On;se.createCoreData=Hn;se.createDraggableData=Vn;se.getBoundPosition=Bn;se.getControlPosition=$n;se.snapToGrid=Fn;var ee=ie,Se=$;function Bn(t,n,r){if(!t.props.bounds)return[n,r];let{bounds:i}=t.props;i=typeof i=="string"?i:Un(i);const h=yt(t);if(typeof i=="string"){const{ownerDocument:g}=h,m=g.defaultView;let p;if(i==="parent"?p=h.parentNode:p=g.querySelector(i),!(p instanceof m.HTMLElement))throw new Error('Bounds selector "'+i+'" could not find an element.');const f=p,w=m.getComputedStyle(h),P=m.getComputedStyle(f);i={left:-h.offsetLeft+(0,ee.int)(P.paddingLeft)+(0,ee.int)(w.marginLeft),top:-h.offsetTop+(0,ee.int)(P.paddingTop)+(0,ee.int)(w.marginTop),right:(0,Se.innerWidth)(f)-(0,Se.outerWidth)(h)-h.offsetLeft+(0,ee.int)(P.paddingRight)-(0,ee.int)(w.marginRight),bottom:(0,Se.innerHeight)(f)-(0,Se.outerHeight)(h)-h.offsetTop+(0,ee.int)(P.paddingBottom)-(0,ee.int)(w.marginBottom)}}return(0,ee.isNum)(i.right)&&(n=Math.min(n,i.right)),(0,ee.isNum)(i.bottom)&&(r=Math.min(r,i.bottom)),(0,ee.isNum)(i.left)&&(n=Math.max(n,i.left)),(0,ee.isNum)(i.top)&&(r=Math.max(r,i.top)),[n,r]}function Fn(t,n,r){const i=Math.round(n/t[0])*t[0],h=Math.round(r/t[1])*t[1];return[i,h]}function _n(t){return t.props.axis==="both"||t.props.axis==="x"}function On(t){return t.props.axis==="both"||t.props.axis==="y"}function $n(t,n,r){const i=typeof n=="number"?(0,Se.getTouch)(t,n):null;if(typeof n=="number"&&!i)return null;const h=yt(r),g=r.props.offsetParent||h.offsetParent||h.ownerDocument.body;return(0,Se.offsetXYFromParent)(i||t,g,r.props.scale)}function Hn(t,n,r){const i=!(0,ee.isNum)(t.lastX),h=yt(t);return i?{node:h,deltaX:0,deltaY:0,lastX:n,lastY:r,x:n,y:r}:{node:h,deltaX:n-t.lastX,deltaY:r-t.lastY,lastX:t.lastX,lastY:t.lastY,x:n,y:r}}function Vn(t,n){const r=t.props.scale;return{node:n.node,x:t.state.x+n.deltaX/r,y:t.state.y+n.deltaY/r,deltaX:n.deltaX/r,deltaY:n.deltaY/r,lastX:t.state.x,lastY:t.state.y}}function Un(t){return{left:t.left,top:t.top,right:t.right,bottom:t.bottom}}function yt(t){const n=t.findDOMNode();if(!n)throw new Error("<DraggableCore>: Unmounted during event!");return n}var He={},Ve={};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.default=Yn;function Yn(){}Object.defineProperty(He,"__esModule",{value:!0});He.default=void 0;var ot=Wn(o),K=bt(Tt),Gn=bt(It),Y=$,de=se,lt=ie,Pe=bt(Ve);function bt(t){return t&&t.__esModule?t:{default:t}}function Kt(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,r=new WeakMap;return(Kt=function(i){return i?r:n})(t)}function Wn(t,n){if(t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=Kt(n);if(r&&r.has(t))return r.get(t);var i={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in t)if(g!=="default"&&Object.prototype.hasOwnProperty.call(t,g)){var m=h?Object.getOwnPropertyDescriptor(t,g):null;m&&(m.get||m.set)?Object.defineProperty(i,g,m):i[g]=t[g]}return i.default=t,r&&r.set(t,i),i}function q(t,n,r){return n=Xn(n),n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function Xn(t){var n=jn(t,"string");return typeof n=="symbol"?n:String(n)}function jn(t,n){if(typeof t!="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var i=r.call(t,n);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(t)}const re={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}};let ue=re.mouse,Ue=class extends ot.Component{constructor(){super(...arguments),q(this,"dragging",!1),q(this,"lastX",NaN),q(this,"lastY",NaN),q(this,"touchIdentifier",null),q(this,"mounted",!1),q(this,"handleDragStart",n=>{if(this.props.onMouseDown(n),!this.props.allowAnyClick&&typeof n.button=="number"&&n.button!==0)return!1;const r=this.findDOMNode();if(!r||!r.ownerDocument||!r.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");const{ownerDocument:i}=r;if(this.props.disabled||!(n.target instanceof i.defaultView.Node)||this.props.handle&&!(0,Y.matchesSelectorAndParentsTo)(n.target,this.props.handle,r)||this.props.cancel&&(0,Y.matchesSelectorAndParentsTo)(n.target,this.props.cancel,r))return;n.type==="touchstart"&&n.preventDefault();const h=(0,Y.getTouchIdentifier)(n);this.touchIdentifier=h;const g=(0,de.getControlPosition)(n,h,this);if(g==null)return;const{x:m,y:p}=g,f=(0,de.createCoreData)(this,m,p);(0,Pe.default)("DraggableCore: handleDragStart: %j",f),(0,Pe.default)("calling",this.props.onStart),!(this.props.onStart(n,f)===!1||this.mounted===!1)&&(this.props.enableUserSelectHack&&(0,Y.addUserSelectStyles)(i),this.dragging=!0,this.lastX=m,this.lastY=p,(0,Y.addEvent)(i,ue.move,this.handleDrag),(0,Y.addEvent)(i,ue.stop,this.handleDragStop))}),q(this,"handleDrag",n=>{const r=(0,de.getControlPosition)(n,this.touchIdentifier,this);if(r==null)return;let{x:i,y:h}=r;if(Array.isArray(this.props.grid)){let p=i-this.lastX,f=h-this.lastY;if([p,f]=(0,de.snapToGrid)(this.props.grid,p,f),!p&&!f)return;i=this.lastX+p,h=this.lastY+f}const g=(0,de.createCoreData)(this,i,h);if((0,Pe.default)("DraggableCore: handleDrag: %j",g),this.props.onDrag(n,g)===!1||this.mounted===!1){try{this.handleDragStop(new MouseEvent("mouseup"))}catch{const f=document.createEvent("MouseEvents");f.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.handleDragStop(f)}return}this.lastX=i,this.lastY=h}),q(this,"handleDragStop",n=>{if(!this.dragging)return;const r=(0,de.getControlPosition)(n,this.touchIdentifier,this);if(r==null)return;let{x:i,y:h}=r;if(Array.isArray(this.props.grid)){let f=i-this.lastX||0,w=h-this.lastY||0;[f,w]=(0,de.snapToGrid)(this.props.grid,f,w),i=this.lastX+f,h=this.lastY+w}const g=(0,de.createCoreData)(this,i,h);if(this.props.onStop(n,g)===!1||this.mounted===!1)return!1;const p=this.findDOMNode();p&&this.props.enableUserSelectHack&&(0,Y.removeUserSelectStyles)(p.ownerDocument),(0,Pe.default)("DraggableCore: handleDragStop: %j",g),this.dragging=!1,this.lastX=NaN,this.lastY=NaN,p&&((0,Pe.default)("DraggableCore: Removing handlers"),(0,Y.removeEvent)(p.ownerDocument,ue.move,this.handleDrag),(0,Y.removeEvent)(p.ownerDocument,ue.stop,this.handleDragStop))}),q(this,"onMouseDown",n=>(ue=re.mouse,this.handleDragStart(n))),q(this,"onMouseUp",n=>(ue=re.mouse,this.handleDragStop(n))),q(this,"onTouchStart",n=>(ue=re.touch,this.handleDragStart(n))),q(this,"onTouchEnd",n=>(ue=re.touch,this.handleDragStop(n)))}componentDidMount(){this.mounted=!0;const n=this.findDOMNode();n&&(0,Y.addEvent)(n,re.touch.start,this.onTouchStart,{passive:!1})}componentWillUnmount(){this.mounted=!1;const n=this.findDOMNode();if(n){const{ownerDocument:r}=n;(0,Y.removeEvent)(r,re.mouse.move,this.handleDrag),(0,Y.removeEvent)(r,re.touch.move,this.handleDrag),(0,Y.removeEvent)(r,re.mouse.stop,this.handleDragStop),(0,Y.removeEvent)(r,re.touch.stop,this.handleDragStop),(0,Y.removeEvent)(n,re.touch.start,this.onTouchStart,{passive:!1}),this.props.enableUserSelectHack&&(0,Y.removeUserSelectStyles)(r)}}findDOMNode(){var n,r;return(n=this.props)!==null&&n!==void 0&&n.nodeRef?(r=this.props)===null||r===void 0||(r=r.nodeRef)===null||r===void 0?void 0:r.current:Gn.default.findDOMNode(this)}render(){return ot.cloneElement(ot.Children.only(this.props.children),{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}};He.default=Ue;q(Ue,"displayName","DraggableCore");q(Ue,"propTypes",{allowAnyClick:K.default.bool,children:K.default.node.isRequired,disabled:K.default.bool,enableUserSelectHack:K.default.bool,offsetParent:function(t,n){if(t[n]&&t[n].nodeType!==1)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:K.default.arrayOf(K.default.number),handle:K.default.string,cancel:K.default.string,nodeRef:K.default.object,onStart:K.default.func,onDrag:K.default.func,onStop:K.default.func,onMouseDown:K.default.func,scale:K.default.number,className:lt.dontSetMe,style:lt.dontSetMe,transform:lt.dontSetMe});q(Ue,"defaultProps",{allowAnyClick:!1,disabled:!1,enableUserSelectHack:!0,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1});(function(t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DraggableCore",{enumerable:!0,get:function(){return f.default}}),t.default=void 0;var n=N(o),r=P(Tt),i=P(It),h=P(pn),g=$,m=se,p=ie,f=P(He),w=P(Ve);function P(u){return u&&u.__esModule?u:{default:u}}function I(u){if(typeof WeakMap!="function")return null;var b=new WeakMap,x=new WeakMap;return(I=function(d){return d?x:b})(u)}function N(u,b){if(u&&u.__esModule)return u;if(u===null||typeof u!="object"&&typeof u!="function")return{default:u};var x=I(b);if(x&&x.has(u))return x.get(u);var d={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in u)if(y!=="default"&&Object.prototype.hasOwnProperty.call(u,y)){var s=c?Object.getOwnPropertyDescriptor(u,y):null;s&&(s.get||s.set)?Object.defineProperty(d,y,s):d[y]=u[y]}return d.default=u,x&&x.set(u,d),d}function R(){return R=Object.assign?Object.assign.bind():function(u){for(var b=1;b<arguments.length;b++){var x=arguments[b];for(var d in x)Object.prototype.hasOwnProperty.call(x,d)&&(u[d]=x[d])}return u},R.apply(this,arguments)}function D(u,b,x){return b=B(b),b in u?Object.defineProperty(u,b,{value:x,enumerable:!0,configurable:!0,writable:!0}):u[b]=x,u}function B(u){var b=S(u,"string");return typeof b=="symbol"?b:String(b)}function S(u,b){if(typeof u!="object"||u===null)return u;var x=u[Symbol.toPrimitive];if(x!==void 0){var d=x.call(u,b);if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(b==="string"?String:Number)(u)}class E extends n.Component{static getDerivedStateFromProps(b,x){let{position:d}=b,{prevPropsPosition:c}=x;return d&&(!c||d.x!==c.x||d.y!==c.y)?((0,w.default)("Draggable: getDerivedStateFromProps %j",{position:d,prevPropsPosition:c}),{x:d.x,y:d.y,prevPropsPosition:{...d}}):null}constructor(b){super(b),D(this,"onDragStart",(x,d)=>{if((0,w.default)("Draggable: onDragStart: %j",d),this.props.onStart(x,(0,m.createDraggableData)(this,d))===!1)return!1;this.setState({dragging:!0,dragged:!0})}),D(this,"onDrag",(x,d)=>{if(!this.state.dragging)return!1;(0,w.default)("Draggable: onDrag: %j",d);const c=(0,m.createDraggableData)(this,d),y={x:c.x,y:c.y,slackX:0,slackY:0};if(this.props.bounds){const{x:C,y:T}=y;y.x+=this.state.slackX,y.y+=this.state.slackY;const[F,W]=(0,m.getBoundPosition)(this,y.x,y.y);y.x=F,y.y=W,y.slackX=this.state.slackX+(C-y.x),y.slackY=this.state.slackY+(T-y.y),c.x=y.x,c.y=y.y,c.deltaX=y.x-this.state.x,c.deltaY=y.y-this.state.y}if(this.props.onDrag(x,c)===!1)return!1;this.setState(y)}),D(this,"onDragStop",(x,d)=>{if(!this.state.dragging||this.props.onStop(x,(0,m.createDraggableData)(this,d))===!1)return!1;(0,w.default)("Draggable: onDragStop: %j",d);const y={dragging:!1,slackX:0,slackY:0};if(!!this.props.position){const{x:C,y:T}=this.props.position;y.x=C,y.y=T}this.setState(y)}),this.state={dragging:!1,dragged:!1,x:b.position?b.position.x:b.defaultPosition.x,y:b.position?b.position.y:b.defaultPosition.y,prevPropsPosition:{...b.position},slackX:0,slackY:0,isElementSVG:!1},b.position&&!(b.onDrag||b.onStop)&&console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element.")}componentDidMount(){typeof window.SVGElement<"u"&&this.findDOMNode()instanceof window.SVGElement&&this.setState({isElementSVG:!0})}componentWillUnmount(){this.setState({dragging:!1})}findDOMNode(){var b,x;return(b=(x=this.props)===null||x===void 0||(x=x.nodeRef)===null||x===void 0?void 0:x.current)!==null&&b!==void 0?b:i.default.findDOMNode(this)}render(){const{axis:b,bounds:x,children:d,defaultPosition:c,defaultClassName:y,defaultClassNameDragging:s,defaultClassNameDragged:C,position:T,positionOffset:F,scale:W,...V}=this.props;let ae={},k=null;const _=!!!T||this.state.dragging,le=T||c,ge={x:(0,m.canDragX)(this)&&_?this.state.x:le.x,y:(0,m.canDragY)(this)&&_?this.state.y:le.y};this.state.isElementSVG?k=(0,g.createSVGTransform)(ge,F):ae=(0,g.createCSSTransform)(ge,F);const ze=(0,h.default)(d.props.className||"",y,{[s]:this.state.dragging,[C]:this.state.dragged});return n.createElement(f.default,R({},V,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),n.cloneElement(n.Children.only(d),{className:ze,style:{...d.props.style,...ae},transform:k}))}}t.default=E,D(E,"displayName","Draggable"),D(E,"propTypes",{...f.default.propTypes,axis:r.default.oneOf(["both","x","y","none"]),bounds:r.default.oneOfType([r.default.shape({left:r.default.number,right:r.default.number,top:r.default.number,bottom:r.default.number}),r.default.string,r.default.oneOf([!1])]),defaultClassName:r.default.string,defaultClassNameDragging:r.default.string,defaultClassNameDragged:r.default.string,defaultPosition:r.default.shape({x:r.default.number,y:r.default.number}),positionOffset:r.default.shape({x:r.default.oneOfType([r.default.number,r.default.string]),y:r.default.oneOfType([r.default.number,r.default.string])}),position:r.default.shape({x:r.default.number,y:r.default.number}),className:p.dontSetMe,style:p.dontSetMe,transform:p.dontSetMe}),D(E,"defaultProps",{...f.default.defaultProps,axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},scale:1})})(Ut);const{default:Zt,DraggableCore:qn}=Ut;$e.exports=Zt;$e.exports.default=Zt;$e.exports.DraggableCore=qn;var Jn=$e.exports;const Kn=da(Jn),Zn=({items:t,position:n="left",defaultCollapsed:r=!1,activeItemId:i,onItemClick:h,className:g="",style:m={}})=>{const[p,f]=o.useState(r),[w,P]=o.useState({left:0,top:0,right:0,bottom:0});return ua.useEffect(()=>{const I=()=>{P({left:0,top:0,right:window.innerWidth-(p?50:200),bottom:window.innerHeight-400})};return I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[p]),e(Kn,{bounds:w,children:a("div",{className:`sidebar ${p?"collapsed":""} ${g}`,style:{position:"fixed",[n]:0,top:"80px",width:p?"50px":"200px",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",transition:"width 0.3s ease",zIndex:1e3,...m},children:[e("div",{className:"sidebar-content",style:{padding:"8px"},children:t.map(I=>a("div",{className:`sidebar-item ${i===I.id?"active":""}`,onClick:()=>h==null?void 0:h(I.id),style:{display:"flex",alignItems:"center",padding:"8px",cursor:"pointer",borderRadius:"4px",backgroundColor:i===I.id?"rgba(0, 0, 0, 0.05)":"transparent",color:i===I.id?"#000":"#666",marginBottom:"4px"},children:[e("div",{className:"icon",style:{fontSize:"20px"},children:I.icon}),!p&&e("span",{style:{marginLeft:"12px",whiteSpace:"nowrap"},children:I.label})]},I.id))}),e("button",{onClick:()=>f(!p),style:{position:"absolute",[n==="left"?"right":"left"]:"-20px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"40px",border:"none",borderRadius:n==="left"?"0 20px 20px 0":"20px 0 0 20px",backgroundColor:"rgba(0, 0, 0, 0.1)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#666"},children:n==="left"?p?e(Ae,{}):e(Re,{}):p?e(Re,{}):e(Ae,{})})]})})},Qn=({onBack:t,onYumiReferenceSelect:n})=>{Lt(),_t();const[r,i]=o.useState(!1),[h,g]=o.useState(0),[m,p]=o.useState(null),[f,w]=o.useState(null),[P,I]=o.useState("brush"),[N,R]=o.useState(!1),[D,B]=o.useState(!1),[S,E]=o.useState({name:"",age:"",background:"",catchphrase:"",personalityTraits:[],visualMotifs:[],designElements:[]}),[u,b]=o.useState(""),x=[{id:"prompt",icon:"✨",label:"Prompt Builder"},{id:"style",icon:"🎨",label:"Style Settings"},{id:"history",icon:"📜",label:"Generation History"}];return o.useEffect(()=>{Ne.get("/api/billing/image-gen-status").then(d=>{i(d.data.hasAccess),g(d.data.freeTrialsUsed||0)}).catch(console.error)},[]),a("div",{className:"image-generation-mode",style:{minHeight:"100vh",backgroundColor:"#1a1a2e",color:"#fff"},children:[a("div",{style:{position:"fixed",top:0,left:0,right:0,height:"60px",backgroundColor:"rgba(26, 26, 46, 0.95)",backdropFilter:"blur(10px)",display:"flex",alignItems:"center",padding:"0 20px",zIndex:1e3,boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:[a("button",{onClick:t,style:{background:"transparent",border:"none",color:"white",display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"16px"},children:[e(ht,{})," Back to Modes"]}),e("div",{style:{marginLeft:"auto",fontSize:"18px",fontWeight:500},children:"AI Image Generation"})]}),e(Zn,{items:x,position:"left",defaultCollapsed:!1,style:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",color:"white"}}),a("div",{style:{marginTop:"80px",marginLeft:"220px",padding:"20px"},children:[a("div",{style:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",borderRadius:"12px",padding:"20px",marginBottom:"20px"},children:[e("textarea",{value:u,onChange:d=>b(d.target.value),placeholder:"Describe the image you want to generate...",style:{width:"100%",minHeight:"100px",padding:"15px",backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"8px",color:"white",fontSize:"16px",lineHeight:"1.6",resize:"vertical"},className:"prompt-textarea"}),a("div",{style:{marginTop:"10px",display:"flex",gap:"10px"},children:[e("button",{style:{padding:"10px 20px",backgroundColor:"#4a90e2",border:"none",borderRadius:"6px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Generate"}),e("button",{style:{padding:"10px 20px",backgroundColor:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"6px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Clear"})]})]}),e("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"20px",padding:"20px",backgroundColor:"rgba(255, 255, 255, 0.05)",borderRadius:"12px"},children:e("div",{style:{aspectRatio:"1",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255, 255, 255, 0.5)"},children:"Generated images will appear here"})})]})]})},er=({onBack:t})=>{const{language:n}=oa();Lt();const[r,i]=o.useState("creation"),[h,g]=o.useState(!1),[m,p]=o.useState(!1),[f,w]=o.useState([]),[P,I]=o.useState(null),[N,R]=o.useState(!1),[D,B]=o.useState("戦おう一緒に"),[S,E]=o.useState({type:"solid",color:"#ffffff",gradient:"linear-gradient(45deg, #f3f3f3, #ffffff)",image:"",opacity:1}),u=C=>{if(w(C),C[0]&&S.type==="image"){const T=new FileReader;T.onloadend=()=>{E(F=>({...F,image:T.result}))},T.readAsDataURL(C[0])}},b=C=>{I(C),R(!1)},x=C=>{i(C)},d=()=>{switch(S.type){case"solid":return{backgroundColor:S.color};case"gradient":return{background:S.gradient};case"image":return{backgroundImage:S.image?`url(${S.image})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"};default:return{}}},c=()=>{t()},y=async C=>{const T=C==="戦おう一緒に"?"３デザイン提案":C==="面倒いけどすごい"?"詳細バリエーション":"５キャラプロンプト＋配色";try{console.log(`Generating with strategy: ${T}`)}catch(F){console.error("Generation failed:",F)}},s=()=>r==="generation"?e(Qn,{onBack:c,onYumiReferenceSelect:b}):e(un,{onBack:c,uploadedFiles:f,onFileUpload:u,selectedReferenceUrl:P,backgroundSettings:S,showCustomization:m,onCustomizeToggle:()=>p(!m),showYumiReferences:N,setShowYumiReferences:R,onYumiReferenceSelect:b});return a("div",{className:"anime-chara-helper-app",style:{...r==="creation"?{...d(),opacity:S.opacity}:{}},children:[e(ha,{className:"back-button",onClick:c,sx:{position:"absolute",top:16,left:16,zIndex:1e3},children:e(Ea,{})}),a("div",{className:"mode-switcher",children:[e("button",{onClick:()=>x("creation"),className:`mode-btn ${r==="creation"?"active":""}`,title:"Creation Mode v1.2",children:"🎨 Create"}),e("button",{onClick:()=>x("generation"),className:`mode-btn ${r==="generation"?"active":""}`,title:"AI Generation Mode",children:"🤖 AI Generate"})]}),s(),m&&r==="creation"&&a("div",{className:"shared-customization-panel",children:[e("h3",{children:"🌈 Background Settings"}),a("div",{className:"customization-section",children:[e("h4",{children:"Background Type"}),a("div",{className:"bg-type-selector",children:[e("button",{onClick:()=>E(C=>({...C,type:"solid"})),className:`bg-type-btn ${S.type==="solid"?"active":""}`,children:"Solid"}),e("button",{onClick:()=>E(C=>({...C,type:"gradient"})),className:`bg-type-btn ${S.type==="gradient"?"active":""}`,children:"Gradient"}),e("button",{onClick:()=>E(C=>({...C,type:"image"})),className:`bg-type-btn ${S.type==="image"?"active":""}`,children:"Image"})]})]})]}),e(la,{isOpen:h,onClose:()=>g(!1),mode:"anime-chara-helper",floatingMode:!h}),a("div",{className:"content-area",children:[e(La,{mode:D,onChange:B,domain:"anime"}),e("textarea",{className:"prompt-input",placeholder:D==="戦おう一緒に"?"アイデアとあらすじを入力…":D==="面倒いけどすごい"?"できるだけ詳細に説明してください…":"アイデアだけを入力してください…",style:{width:"100%",minHeight:"200px",padding:"20px",backgroundColor:"rgba(255, 255, 255, 0.8)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",fontSize:"16px",lineHeight:"1.6",resize:"vertical",marginBottom:"16px"}}),e("button",{className:"generate-button",onClick:()=>y(D),style:{background:"#ff69b4",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",marginBottom:"16px",transition:"all 0.2s ease"},children:"アウトラインを生成"})]})]})},or=Object.freeze(Object.defineProperty({__proto__:null,default:er},Symbol.toStringTag,{value:"Module"}));export{er as A,or as a,Jn as c};
//# sourceMappingURL=AnimeCharaHelperApp-CENhVs9p.js.map
