{"version":3,"file":"WritingHelperScreen-BqjqOLFN.js","sources":["../../src/writing-helper/WritingHelperScreen.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { \n  IoArrowBack, \n  IoMenu, \n  IoClose, \n  IoSwapHorizontal,\n  IoSettings,\n  IoCloudUpload,\n  IoImage,\n  IoColorPalette\n} from 'react-icons/io5';\nimport AIAssistant from '../components/AIAssistant';\nimport { useAuth } from '../hooks/useAuth';\nimport { CreativeControlPanel } from '../shared/components/CreativeControlPanel';\nimport { IterativeFeedbackPanel } from '../shared/components/IterativeFeedbackPanel';\nimport { CreativeControlSettings, CreativeSession, CreativeVersion, CreativeFeedback } from '../shared/types/creativeModes';\nimport { smartPromptEngine, createCreativeSession, updateUserHistory } from '../shared/services/smartPromptEngine';\nimport { getAvailablePersonalities } from '../shared/services/yumiPersonalityService';\nimport { ModeToggle, YumiMode } from '../shared/components/ModeToggle';\n\ninterface WritingHelperScreenProps {\n  content: string;\n  onContentChange: (content: string) => void;\n  onBack: () => void;\n}\n\ntype SidebarPosition = 'left' | 'right';\n\nconst WritingHelperScreen: React.FC<WritingHelperScreenProps> = ({\n  content,\n  onContentChange,\n  onBack\n}) => {\n  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);\n  const [sidebarPosition, setSidebarPosition] = useState<SidebarPosition>('left');\n  const [activeTool, setActiveTool] = useState<string | null>(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n  const [showAI, setShowAI] = useState(false);\n  const [showCustomization, setShowCustomization] = useState(false);\n  const [backgroundSettings, setBackgroundSettings] = useState({\n    type: 'solid' as 'solid' | 'gradient' | 'image',\n    color: '#1a1a2e',\n    gradient: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)',\n    image: '',\n    opacity: 0.9\n  });\n  const [uploadedFiles, setUploadedFiles] = useState<File[]>([]);\n  const sidebarRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Creative Control System state\n  const [creativeSession, setCreativeSession] = useState<CreativeSession>(\n    createCreativeSession('writing', {\n      level: 'balanced',\n      yumiPersonality: 'teacher',\n      allowSuggestions: true,\n      memoryNudges: true,\n      iterativeMode: true\n    })\n  );\n  const [showIterativeFeedback, setShowIterativeFeedback] = useState(false);\n  const [currentVersions, setCurrentVersions] = useState<CreativeVersion[]>([]);\n  const [availablePersonalities] = useState<string[]>(getAvailablePersonalities());\n  const [yumiMode, setYumiMode] = useState<YumiMode>('戦おう一緒に');\n\n  // Sidebar dragging\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (sidebarRef.current) {\n      setIsDragging(true);\n      const rect = sidebarRef.current.getBoundingClientRect();\n      setDragOffset({\n        x: e.clientX - rect.left,\n        y: e.clientY - rect.top\n      });\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    if (isDragging && sidebarRef.current) {\n      const newX = e.clientX - dragOffset.x;\n      const screenWidth = window.innerWidth;\n      \n      // Switch sides based on position\n      if (newX < screenWidth / 2 && sidebarPosition === 'right') {\n        setSidebarPosition('left');\n      } else if (newX > screenWidth / 2 && sidebarPosition === 'left') {\n        setSidebarPosition('right');\n      }\n    }\n  };\n\n  const handleMouseUp = () => {\n    setIsDragging(false);\n  };\n\n  const togglePosition = () => {\n    setSidebarPosition(prev => prev === 'left' ? 'right' : 'left');\n  };\n\n  const handleToolClick = (tool: string) => {\n    setActiveTool(activeTool === tool ? null : tool);\n  };\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    setUploadedFiles(prev => [...prev, ...files]);\n    \n    // Handle background image upload\n    if (files[0] && backgroundSettings.type === 'image') {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setBackgroundSettings(prev => ({\n          ...prev,\n          image: reader.result as string\n        }));\n      };\n      reader.readAsDataURL(files[0]);\n    }\n  };\n\n  // Creative Control System handlers\n  const handleCreativeSettingsChange = (settings: CreativeControlSettings) => {\n    const previousSettings = creativeSession.controlSettings;\n    \n    setCreativeSession(prev => ({\n      ...prev,\n      controlSettings: settings\n    }));\n    \n    // Update user history if personality changed\n    if (settings.yumiPersonality !== previousSettings.yumiPersonality) {\n      setCreativeSession(prev => updateUserHistory(prev, {\n        lastUsedPersonality: settings.yumiPersonality\n      }));\n    }\n  };\n\n  const handleVersionSelect = (versionId: string) => {\n    const version = currentVersions.find(v => v.id === versionId);\n    if (version && typeof version.content === 'string') {\n      onContentChange(version.content);\n    }\n  };\n\n  const handleRequestRefinement = (feedback: CreativeFeedback) => {\n    if (creativeSession.controlSettings.level === 'balanced' || creativeSession.controlSettings.allowSuggestions) {\n      // Generate enhanced prompt with personality influence\n      const enhancedPrompt = smartPromptEngine.generateBasePrompt(\n        `${content}\\n\\nRefinement request: ${feedback.question}`,\n        creativeSession.controlSettings\n      );\n      \n      // Apply refinement based on feedback type\n      if (feedback.type === 'mood') {\n        setShowAI(true); // Show AI assistant for mood adjustments\n      } else if (feedback.type === 'style') {\n        // Trigger style refinement\n        const selectedOption = feedback.options[0];\n        if (selectedOption) {\n          generateWritingVariation(selectedOption.label);\n        }\n      }\n\n      // Update session context\n      setCreativeSession(prev => ({\n        ...prev,\n        currentContext: { feedback, originalContent: content }\n      }));\n    }\n  };\n\n  const generateWritingVariation = (variation: string) => {\n    // This would integrate with the AI system to generate variations\n    const variations = {\n      'formal': content.replace(/\\b(awesome|cool|great)\\b/gi, 'excellent'),\n      'casual': content.replace(/\\b(excellent|outstanding)\\b/gi, 'awesome'),\n      'emotional': content + '\\n\\nThis deeply resonates with the human experience.',\n      'humorous': content + '\\n\\n(Just kidding! 😄)'\n    };\n    \n    const variationKey = variation.toLowerCase();\n    if (variationKey in variations) {\n      onContentChange(variations[variationKey as keyof typeof variations]);\n    }\n  };\n\n  const generateWritingVersions = () => {\n    if (creativeSession.controlSettings.iterativeMode && content.trim()) {\n      const versions: CreativeVersion[] = [\n        {\n          id: `version_${Date.now()}_main`,\n          type: 'main',\n          content: content,\n          metadata: {\n            aiConfidence: 0.8,\n            refinementsSuggested: ['Improve clarity', 'Add examples', 'Enhance flow'],\n            personalityInfluence: [creativeSession.controlSettings.yumiPersonality]\n          }\n        }\n      ];\n\n      // Generate personality-influenced alternative\n      if (creativeSession.controlSettings.allowSuggestions) {\n        const personalityPrompt = smartPromptEngine.generateBasePrompt(\n          `Rewrite this with ${creativeSession.controlSettings.yumiPersonality} personality: ${content}`,\n          { ...creativeSession.controlSettings, level: 'freestyle' }\n        );\n        \n        versions.push({\n          id: `version_${Date.now()}_alt`,\n          type: 'alternative',\n          content: content + '\\n\\n[AI-enhanced version would appear here]',\n          metadata: {\n            aiConfidence: 0.7,\n            refinementsSuggested: ['Different tone', 'Personality variation'],\n            personalityInfluence: [creativeSession.controlSettings.yumiPersonality]\n          }\n        });\n      }\n\n      setCurrentVersions(versions);\n      setShowIterativeFeedback(true);\n    }\n  };\n\n  const getBackgroundStyle = () => {\n    switch (backgroundSettings.type) {\n      case 'solid':\n        return { backgroundColor: backgroundSettings.color };\n      case 'gradient':\n        return { background: backgroundSettings.gradient };\n      case 'image':\n        return {\n          backgroundImage: backgroundSettings.image ? `url(${backgroundSettings.image})` : 'none',\n          backgroundSize: 'cover',\n          backgroundPosition: 'center',\n          backgroundRepeat: 'no-repeat'\n        };\n      default:\n        return {};\n    }\n  };\n\n  const writingTools = [\n    { id: 'social', icon: '📱', label: 'Post to Platforms', category: 'social' },\n    { id: 'trending', icon: '📈', label: 'Trending Search', category: 'social' },\n    { id: 'ai-continue', icon: '🤖', label: 'AI Continuation', category: 'ai' },\n    { id: 'instructions', icon: '📝', label: 'Instructions', category: 'ai' },\n    { id: 'generate-versions', icon: '✨', label: 'Generate Versions', category: 'ai' },\n    { id: 'anime-collab', icon: '🎮', label: 'Anime Collaboration', category: 'collaboration' },\n    { id: 'galgame-blog', icon: '💖', label: 'Galgame Blog', category: 'collaboration' },\n    { id: 'novel-writing', icon: '📚', label: 'Novel Writing', category: 'collaboration' },\n    { id: 'test-writing', icon: '✅', label: 'Test Writing', category: 'tools' },\n    { id: 'upload', icon: '📤', label: 'Upload Files', category: 'tools' }\n  ];\n\n  const getCategoryColor = (category: string) => {\n    switch (category) {\n      case 'social': return '#ff6b9d';\n      case 'ai': return '#8b5cf6';\n      case 'collaboration': return '#10b981';\n      case 'tools': return '#f59e0b';\n      default: return '#6b7280';\n    }\n  };\n\n  const renderToolPanel = () => {\n    if (!activeTool) return null;\n\n    const tool = writingTools.map(t => t.id === activeTool ? t : null).find(t => t !== null);\n    if (!tool) return null;\n\n    return (\n      <div className=\"tool-panel\">\n        <h3>{tool.icon} {tool.label}</h3>\n        \n        {activeTool === 'upload' && (\n          <div className=\"upload-panel\">\n            <input\n              type=\"file\"\n              ref={fileInputRef}\n              multiple\n              accept=\"image/*,text/*,.pdf,.doc,.docx\"\n              onChange={handleFileUpload}\n              style={{ display: 'none' }}\n            />\n            <button \n              className=\"upload-btn\"\n              onClick={() => fileInputRef.current?.click()}\n            >\n              <IoCloudUpload size={20} />\n              Upload Files\n            </button>\n            {uploadedFiles.length > 0 && (\n              <div className=\"uploaded-files\">\n                <h4>Uploaded Files:</h4>\n                {uploadedFiles.map((file, index) => (\n                  <div key={index} className=\"file-item\">\n                    <span>{file.name}</span>\n                    <small>({(file.size / 1024).toFixed(1)} KB)</small>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n\n        {activeTool === 'social' && (\n          <div className=\"social-platforms\">\n            <button className=\"platform-btn twitter\" onClick={() => window.open('https://twitter.com/compose/tweet', '_blank')}>🐦 Twitter</button>\n            <button className=\"platform-btn instagram\" onClick={() => window.open('https://www.instagram.com/', '_blank')}>📷 Instagram</button>\n            <button className=\"platform-btn facebook\" onClick={() => window.open('https://www.facebook.com/', '_blank')}>👥 Facebook</button>\n            <button className=\"platform-btn linkedin\" onClick={() => window.open('https://www.linkedin.com/feed/', '_blank')}>💼 LinkedIn</button>\n            <button className=\"platform-btn medium\" onClick={() => window.open('https://medium.com/new-story', '_blank')}>📖 Medium</button>\n            <button className=\"platform-btn wordpress\" onClick={() => window.open('https://wordpress.com/post', '_blank')}>📝 WordPress</button>\n            <div className=\"copy-helper\">\n              <textarea \n                value={content} \n                readOnly \n                placeholder=\"Your content will appear here for easy copying\"\n                rows={4}\n              />\n              <button \n                onClick={() => navigator.clipboard.writeText(content)}\n                className=\"copy-btn\"\n              >\n                📋 Copy Content\n              </button>\n            </div>\n          </div>\n        )}\n\n        {activeTool === 'trending' && (\n          <div className=\"trending-search\">\n            <input type=\"text\" placeholder=\"Search trending topics...\" />\n            <div className=\"platform-filters\">\n              <label><input type=\"checkbox\" /> Twitter</label>\n              <label><input type=\"checkbox\" /> Instagram</label>\n              <label><input type=\"checkbox\" /> TikTok</label>\n              <label><input type=\"checkbox\" /> YouTube</label>\n            </div>\n          </div>\n        )}\n\n        {activeTool === 'ai-continue' && (\n          <div className=\"ai-continuation\">\n            <textarea placeholder=\"Select text to continue or leave empty for auto-continuation...\" />\n            <div className=\"ai-options\">\n              <label>\n                <input type=\"radio\" name=\"tone\" value=\"creative\" />\n                Creative\n              </label>\n              <label>\n                <input type=\"radio\" name=\"tone\" value=\"professional\" />\n                Professional\n              </label>\n              <label>\n                <input type=\"radio\" name=\"tone\" value=\"casual\" />\n                Casual\n              </label>\n            </div>\n            <button className=\"generate-btn\">✨ Continue Writing</button>\n          </div>\n        )}\n\n        {activeTool === 'instructions' && (\n          <div className=\"instructions-panel\">\n            <textarea placeholder=\"Enter specific instructions for AI writing assistance...\" />\n            <div className=\"instruction-types\">\n              <button>📝 Style Guide</button>\n              <button>🎯 Target Audience</button>\n              <button>📏 Length Control</button>\n              <button>🔍 Keywords</button>\n            </div>\n          </div>\n        )}\n\n        {activeTool === 'generate-versions' && (\n          <div className=\"generate-versions-panel\">\n            <h4>✨ Creative Versions</h4>\n            <p>Generate multiple versions of your content with different styles and personalities!</p>\n            \n            <div className=\"version-controls\">\n              <div className=\"control-info\">\n                <strong>Current Mode:</strong> {creativeSession.controlSettings.level}\n                <br />\n                <strong>Personality Guide:</strong> {creativeSession.controlSettings.yumiPersonality}\n              </div>\n              \n              <button \n                className=\"generate-btn primary\"\n                onClick={generateWritingVersions}\n                disabled={!content.trim()}\n              >\n                ✨ Generate Versions\n              </button>\n              \n              <div className=\"quick-variations\">\n                <h5>Quick Style Variations:</h5>\n                <button onClick={() => generateWritingVariation('formal')}>🎩 Formal</button>\n                <button onClick={() => generateWritingVariation('casual')}>😊 Casual</button>\n                <button onClick={() => generateWritingVariation('emotional')}>💫 Emotional</button>\n                <button onClick={() => generateWritingVariation('humorous')}>😄 Humorous</button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {activeTool === 'anime-collab' && (\n          <div className=\"anime-collaboration\">\n            <select>\n              <option>Choose Character...</option>\n              <option>Yumi (Cheerful)</option>\n              <option>Sakura (Mysterious)</option>\n              <option>Hana (Energetic)</option>\n            </select>\n            <div className=\"collab-options\">\n              <button>💬 Character Dialogue</button>\n              <button>🎭 Role Play</button>\n              <button>📖 Story Collaboration</button>\n            </div>\n          </div>\n        )}\n\n        {activeTool === 'galgame-blog' && (\n          <div className=\"galgame-blog\">\n            <div className=\"blog-templates\">\n              <button>💖 Romance Review</button>\n              <button>🎮 Game Analysis</button>\n              <button>👥 Character Guide</button>\n              <button>📊 Rating System</button>\n            </div>\n          </div>\n        )}\n\n        {activeTool === 'novel-writing' && (\n          <div className=\"novel-writing\">\n            <div className=\"novel-tools\">\n              <button>📚 Chapter Planning</button>\n              <button>👥 Character Development</button>\n              <button>🗺️ World Building</button>\n              <button>📝 Plot Outline</button>\n            </div>\n          </div>\n        )}\n\n        {activeTool === 'test-writing' && (\n          <div className=\"test-writing\">\n            <div className=\"test-options\">\n              <button>📝 Grammar Check</button>\n              <button>📊 Readability Score</button>\n              <button>🎯 SEO Analysis</button>\n              <button>💡 Improvement Suggestions</button>\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  const getPlaceholder = (mode: YumiMode) => {\n    switch (mode) {\n      case '戦おう一緒に':\n        return 'アイデアとあらすじを入力…';\n      case '面倒いけどすごい':\n        return 'できるだけ詳細に説明してください…';\n      case '任せて':\n        return 'アイデアだけを入力してください…';\n    }\n  };\n\n  const handleGenerate = async (mode: YumiMode) => {\n    if (!content.trim()) return;\n\n    const strategy = mode === '戦おう一緒に' ? 'refine-3' :\n                    mode === '面倒いけどすごい' ? 'detail-amplify' : 'outline-5';\n\n    try {\n      // TODO: Call the appropriate API endpoint with the strategy\n      console.log(`Generating with strategy: ${strategy}`);\n      // const result = await api.generateWriting(content, strategy);\n      // onContentChange(result);\n    } catch (error) {\n      console.error('Generation failed:', error);\n    }\n  };\n\n  return (\n    <div \n      className=\"writing-helper-screen\"\n      style={{\n        ...getBackgroundStyle(),\n        opacity: backgroundSettings.opacity\n      }}\n      onMouseMove={handleMouseMove}\n      onMouseUp={handleMouseUp}\n    >\n      {/* Header */}\n      <div className=\"screen-header\">\n        <button className=\"back-btn\" onClick={onBack}>\n          <IoArrowBack size={24} />\n        </button>\n        <h1>✍️ Writing Helper</h1>\n        <button \n          className=\"customize-btn\"\n          onClick={() => setShowCustomization(!showCustomization)}\n        >\n          <IoSettings size={24} />\n        </button>\n      </div>\n\n      {/* Customization Panel */}\n      {showCustomization && (\n        <div className=\"customization-panel\">\n          <h3>🎨 Customize Writing Helper</h3>\n          \n          <div className=\"customization-section\">\n            <h4>Background</h4>\n            <div className=\"bg-type-selector\">\n              <button \n                className={backgroundSettings.type === 'solid' ? 'active' : ''}\n                onClick={() => setBackgroundSettings(prev => ({ ...prev, type: 'solid' }))}\n              >\n                <IoColorPalette size={16} />\n                Solid\n              </button>\n              <button \n                className={backgroundSettings.type === 'gradient' ? 'active' : ''}\n                onClick={() => setBackgroundSettings(prev => ({ ...prev, type: 'gradient' }))}\n              >\n                🌈 Gradient\n              </button>\n              <button\n                className={backgroundSettings.type === 'image' ? 'active' : ''}\n                onClick={() => setBackgroundSettings(prev => ({ ...prev, type: 'image' }))}\n              >\n                <IoImage size={16} />\n                Image\n              </button>\n            </div>\n\n            {backgroundSettings.type === 'solid' && (\n              <div className=\"color-picker\">\n                <input \n                  type=\"color\" \n                  value={backgroundSettings.color}\n                  onChange={(e) => setBackgroundSettings(prev => ({ ...prev, color: e.target.value }))}\n                />\n              </div>\n            )}\n\n            {backgroundSettings.type === 'gradient' && (\n              <div className=\"gradient-presets\">\n                <button onClick={() => setBackgroundSettings(prev => ({ ...prev, gradient: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)' }))}>\n                  Dark Blue\n                </button>\n                <button onClick={() => setBackgroundSettings(prev => ({ ...prev, gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }))}>\n                  Purple\n                </button>\n                <button onClick={() => setBackgroundSettings(prev => ({ ...prev, gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' }))}>\n                  Pink\n                </button>\n              </div>\n            )}\n\n            {backgroundSettings.type === 'image' && (\n              <div className=\"image-upload\">\n        <button\n                  onClick={() => fileInputRef.current?.click()}\n                  className=\"upload-btn\"\n                >\n                  <IoCloudUpload size={16} />\n                  Upload Background\n                </button>\n              </div>\n            )}\n\n            <div className=\"opacity-slider\">\n              <label>Opacity: {Math.round(backgroundSettings.opacity * 100)}%</label>\n              <input \n                type=\"range\"\n                min=\"0.1\"\n                max=\"1\"\n                step=\"0.1\"\n                value={backgroundSettings.opacity}\n                onChange={(e) => setBackgroundSettings(prev => ({ ...prev, opacity: parseFloat(e.target.value) }))}\n              />\n            </div>\n          </div>\n\n          <div className=\"customization-section\">\n            <h4>Sidebar Settings</h4>\n            <div className=\"sidebar-options\">\n              <button onClick={togglePosition}>\n                <IoSwapHorizontal size={16} />\n                Switch to {sidebarPosition === 'left' ? 'Right' : 'Left'}\n              </button>\n              <button onClick={() => setSidebarCollapsed(!sidebarCollapsed)}>\n                {sidebarCollapsed ? <IoMenu size={16} /> : <IoClose size={16} />}\n                {sidebarCollapsed ? 'Expand' : 'Collapse'}\n        </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Main Content Area */}\n      <div className={`content-area ${sidebarCollapsed ? 'sidebar-collapsed' : ''} sidebar-${sidebarPosition}`}>\n        <ModeToggle\n          mode={yumiMode}\n          onChange={setYumiMode}\n          domain=\"writing\"\n        />\n        <textarea\n          className=\"main-editor\"\n          value={content}\n          onChange={(e) => onContentChange(e.target.value)}\n          placeholder={getPlaceholder(yumiMode)}\n          style={{\n            width: '100%',\n            minHeight: '500px',\n            padding: '20px',\n            backgroundColor: 'rgba(255, 255, 255, 0.8)',\n            border: '1px solid rgba(255, 255, 255, 0.2)',\n            borderRadius: '8px',\n            fontSize: '16px',\n            lineHeight: '1.6',\n            resize: 'vertical'\n          }}\n        />\n        <button\n          className=\"generate-button\"\n          onClick={() => handleGenerate(yumiMode)}\n          style={{\n            background: '#ff69b4',\n            color: 'white',\n            border: 'none',\n            padding: '12px 24px',\n            borderRadius: '8px',\n            fontSize: '16px',\n            fontWeight: 'bold',\n            cursor: 'pointer',\n            marginTop: '16px',\n            transition: 'all 0.2s ease'\n          }}\n        >\n          生成 ▶︎\n        </button>\n      </div>\n\n      {/* Draggable Sidebar */}\n      <div \n        ref={sidebarRef}\n        className={`writing-sidebar ${sidebarCollapsed ? 'collapsed' : ''} ${sidebarPosition}`}\n        style={{ cursor: isDragging ? 'grabbing' : 'grab' }}\n      >\n        {/* Sidebar Header */}\n        <div className=\"sidebar-header\" onMouseDown={handleMouseDown}>\n          <div className=\"sidebar-controls\">\n            <button \n              className=\"collapse-btn\"\n              onClick={() => setSidebarCollapsed(!sidebarCollapsed)}\n            >\n              {sidebarCollapsed ? <IoMenu size={20} /> : <IoClose size={20} />}\n            </button>\n            <button className=\"position-btn\" onClick={togglePosition}>\n              <IoSwapHorizontal size={20} />\n            </button>\n          </div>\n          {!sidebarCollapsed && <h3>Writing Tools</h3>}\n        </div>\n\n        {/* Tools */}\n        {!sidebarCollapsed && (\n          <div className=\"sidebar-content\">\n            <div className=\"tools-grid\">\n              {writingTools.map(tool => (\n                <button\n                  key={tool.id}\n                  className={`tool-btn ${activeTool === tool.id ? 'active' : ''}`}\n                  style={{ '--category-color': getCategoryColor(tool.category) } as React.CSSProperties}\n                  onClick={() => handleToolClick(tool.id)}\n                >\n                  <span className=\"tool-icon\">{tool.icon}</span>\n                  <span className=\"tool-label\">{tool.label}</span>\n                </button>\n              ))}\n            </div>\n\n            {/* Tool Panel */}\n            {renderToolPanel()}\n          </div>\n        )}\n\n        {/* Collapsed Icons */}\n        {sidebarCollapsed && (\n          <div className=\"collapsed-icons\">\n            {writingTools.map(tool => (\n              <button\n                key={tool.id}\n                className=\"collapsed-tool-btn\"\n                onClick={() => {\n                  setSidebarCollapsed(false);\n                  handleToolClick(tool.id);\n                }}\n                title={tool.label}\n              >\n                {tool.icon}\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* AI Assistant */}\n      <AIAssistant \n        isOpen={showAI}\n        onClose={() => setShowAI(false)}\n        mode=\"writing-helper\"\n        floatingMode={!showAI}\n      />\n\n      {/* Creative Control Panel */}\n      <CreativeControlPanel\n        currentSettings={creativeSession.controlSettings}\n        onSettingsChange={handleCreativeSettingsChange}\n        userHistory={creativeSession.userHistory}\n        availablePersonalities={availablePersonalities}\n        mode=\"writing\"\n      />\n\n      {/* Iterative Feedback Panel */}\n      {showIterativeFeedback && currentVersions.length > 0 && (\n        <IterativeFeedbackPanel\n          versions={currentVersions}\n          onVersionSelect={handleVersionSelect}\n          onRequestRefinement={handleRequestRefinement}\n          currentPersonality={creativeSession.controlSettings.yumiPersonality}\n          refinementSuggestions={[\n            'Improve clarity',\n            'Add examples',\n            'Enhance flow',\n            'Adjust tone',\n            'Simplify language',\n            'Add emotion'\n          ]}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default WritingHelperScreen; "],"names":["WritingHelperScreen","content","onContentChange","onBack","sidebarCollapsed","setSidebarCollapsed","useState","sidebarPosition","setSidebarPosition","activeTool","setActiveTool","isDragging","setIsDragging","dragOffset","setDragOffset","x","y","showAI","setShowAI","showCustomization","setShowCustomization","backgroundSettings","setBackgroundSettings","type","color","gradient","image","opacity","uploadedFiles","setUploadedFiles","sidebarRef","useRef","fileInputRef","creativeSession","setCreativeSession","createCreativeSession","level","yumiPersonality","allowSuggestions","memoryNudges","iterativeMode","showIterativeFeedback","setShowIterativeFeedback","currentVersions","setCurrentVersions","availablePersonalities","getAvailablePersonalities","yumiMode","setYumiMode","handleMouseDown","e","current","rect","getBoundingClientRect","clientX","left","clientY","top","handleMouseMove","newX","screenWidth","window","innerWidth","handleMouseUp","togglePosition","prev","handleToolClick","tool","handleFileUpload","files","Array","from","target","reader","FileReader","onloadend","result","readAsDataURL","handleCreativeSettingsChange","settings","previousSettings","controlSettings","updateUserHistory","lastUsedPersonality","handleVersionSelect","versionId","version","find","v","id","handleRequestRefinement","feedback","smartPromptEngine","generateBasePrompt","question","selectedOption","options","generateWritingVariation","label","currentContext","originalContent","variation","variations","replace","variationKey","toLowerCase","generateWritingVersions","trim","versions","Date","now","metadata","aiConfidence","refinementsSuggested","personalityInfluence","push","getBackgroundStyle","backgroundColor","background","backgroundImage","backgroundSize","backgroundPosition","backgroundRepeat","writingTools","icon","category","getCategoryColor","renderToolPanel","map","t","jsxs","jsx","display","click","IoCloudUpload","length","file","index","name","size","toFixed","open","navigator","clipboard","writeText","getPlaceholder","mode","handleGenerate","strategy","log","error","IoArrowBack","IoSettings","IoColorPalette","IoImage","value","Math","round","parseFloat","IoSwapHorizontal","IoMenu","IoClose","ModeToggle","width","minHeight","padding","border","borderRadius","fontSize","lineHeight","resize","fontWeight","cursor","marginTop","transition","AIAssistant","CreativeControlPanel","userHistory","IterativeFeedbackPanel"],"mappings":"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"}